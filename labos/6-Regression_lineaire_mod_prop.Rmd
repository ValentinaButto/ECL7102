---
title: "Régression linéaire simple"
date: "6 octobre 2023"
output: 
    html_document:
        self_contained: false
        lib_dir: libs
        theme: spacelab
        toc: true
        toc_float: true
---

Ce laboratoire doit être remis le **13 octobre à 17h sur Moodle**. Dans votre réponse pour chaque question, veuillez inclure le code R utilisé (s'il y a lieu) et les résultats obtenus.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
require(tidyverse)
```

## 1. Croissance d'une espèce de pin

Le tableau de données `Loblolly` inclus avec R indique la hauteur en pieds (*height*) mesurée à six valeurs de l'âge (3 à 25 ans) pour 14 individus de l'espèce *Pinus taeda*. Chaque individu est indiqué par une valeur différente dans la colonne *Seed*.

```{r}
# nouveau jeux des données 

Loblollymod<-Loblolly


Loblollymod$height2<-Loblollymod$height+(rnorm(length(Loblollymod$height), 4, sd = 2.5))

Loblollymod$height<-NULL

head(Loblollymod)

names(Loblollymod)<-c("age","Seed","height")

write.csv(Loblollymod,"Loblollymod.csv",row.names = FALSE)

hear(Loblollymod)

hist(Loblollymod$height2)
hist(Loblollymod$height)


ggplot(Loblollymod,aes(height2,age))+geom_point()+geom_point(data=Loblollymod,mapping=aes(height,age),color="blue")


head(Loblolly)
```

a) Estimez et interprétez les paramètres d'un modèle linéaire de la hauteur en fonction de l'âge pour ces pins. Est-ce que l'ordonnée à l'origine a un sens biologique pour ce modèle? 


```{r}



mod_h_age <- lm(height ~ age, data = Loblolly)

mod_h_age2 <- lm(height2 ~ age, data = Loblollymod)


summary(mod_h_age)

plot(mod_h_age2)


plot(mod_h_age)

ggplot(Loblolly,aes(height,age))+geom_point()

library(ggplot2)
Loblollymod$resid <- residuals(mod_h_age2)
ggplot(Loblollymod, aes(x = Seed, y = resid)) +
geom_point()

Loblollymod$height <- NULL



```


b) Ajoutez au jeu de données une colonne correspondant aux résidus du modèle en (a), obtenus avec la fonction `residuals`, puis produisez un nuage de points ce ces résidus en fonction de l'arbre (*Seed*). D'après ce résultat, quelle supposition de la régression linéaire pourrait être invalide ici?

c) À partir des graphiques de diagnostic du modèle en (a), indiquez si les suppositions de linéarité, d'égalité des variances et de normalité semblent être respectées.

d) Expliquez comment chacune des suppositions non-respectées identifiées en (b) et (c) affecte la validité des conclusions du modèle. Autrement dit, de quelle façon les estimés et prédictions du modèle pourraient différer de la réalité?


## 2. Diversité des plantes sur des îles britanniques

Le tableau de données [britain_species.csv](britain_species.csv) provient de l'étude de Johnson et Simberloff (1974), "Environmental determinants of island species numbers in the British Isles". Ces données indiquent le nombre d'espèces de plantes vasculaires (*species*) pour 42 îles britanniques en fonction de différents prédicteurs, incluant la surface de l'île en km$^2$ (*area*). 

```{r}
iles <- read.csv("britain_species.csv")
str(iles)


iles$species2<-iles$species+(rpois(length(iles$species), lambda=20))


iles$species<-NULL


write.csv(iles,"iles.csv",row.names = FALSE)

hist(iles$species)
hist(iles$species2)




```

a) Supposons qu'une théorie prédit que le nombre d'espèces ($S$) dépend de la surface d'une île ($A$) en fonction de l'équation suivante, où $c$ et $z$ sont des paramètres à déterminer:

$$S = c A^z$$

Comment pouvez-vous transformer cette équation en un modèle linéaire?

b) Ajustez le modèle en (a) aux données et vérifiez les graphiques de diagnostic. Quel est l'estimé de $z$?

```{r}
mod_sp_area <- lm(log(species) ~ log(area), data = iles)
par(mfrow = c(2, 2))
plot(mod_sp_area)


mod_sp_area2 <- lm(log(species2) ~ log(area), data = iles)
par(mfrow = c(2, 2))
plot(mod_sp_area2)

summary(mod_sp_area2)

iles$species<-NULL


```


c) Supposons que la théorie prédit que $z = 0.25$. Calculez un intervalle de confiance pour $z$ et déterminez si cette hypothèse peut être rejetée ou non à un seuil de signification $\alpha = 0.05$.

d) À partir du modèle en (b), donnez un intervalle de prédiction à 90% du nombre d'espèces pour (i) une île de 0.5 km$^2$ et (ii) une île de 20 km$^2$.

*Notes*: 

- Modifiez le % de l'intervalle de prédiction avec l'argument `level` de `predict`.

- Si la réponse du modèle est une transformation de la variable `species`, vous pouvez appliquer la transformation inverse aux bornes inférieure et supérieure des intervalles obtenus avec `predict` pour retrouver le nombre d'espèces correspondant.
