---
title: "Modèles mixtes"
date: "21 novembre 2018"
output: 
    html_document:
        self_contained: false
        lib_dir: libs
        theme: spacelab
        toc: true
        toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```


## 1. Effet de l'azote sur le rendement de variétés d'avoine

Le tableau de données `Oats` inclus dans le package *nlme* présente les résultats d'une expérience agricole en parcelles divisées (*split-plot*). L'expérience est réalisée en six blocs (`Block`). Chaque bloc est divisé en trois sections où une variété différente d'avoine est semée (`Variety`), puis chaque section est divisée en quatre quadrants qui reçoivent chacun une concentration différente d'azote (`nitro`): 0, 0.2, 0.4 ou 0.6. La variable réponse est le rendement (`yield`) en avoine pour chacun des 72 quadrants (6 blocs x 3 variétés x 4 concentrations d'azote).

```{r}
library(nlme)
data(Oats)
# Changer le bloc en facteur non-ordonné
Oats$Block <- factor(Oats$Block, ordered = FALSE)
str(Oats)
```

(a) Pour les facteurs `Block` et `Variety`, quel type de contrastes devriez-vous utiliser pour comparer l'effet de chaque catégorie à la moyenne, plutôt qu'à une catégorie de référence? Spécifiez ce type de contrastes et nommez les variables de contraste pour en faciliter l'interprétation.

(b) Estimez les paramètres d'un modèle linéaire du rendement en fonction de la concentration d'azote, de la variété d'avoine et d'un effet *fixe* du bloc. Vérifiez s'il est utile d'inclure l'interaction entre l'azote et la variété. Que signifierait une telle interaction?

(c) Choisissez le modèle avec ou sans interaction selon votre résultat en (b), vérifiez les graphiques de diagnostic et interprétez la valeur des coefficients.

(d) Estimez maintenant les paramètres d'un modèle mixte identique au modèle linéaire en (c), excepté que l'effet des blocs est aléatoire plutôt que fixe. Comparez les effets fixes communs aux deux modèles, ainsi que les effets fixes de bloc du modèle précédent aux effets aléatoires par bloc de ce nouveau modèle. Expliquez les différences que vous observez, s'il y a lieu.

(e) Calculez la corrélation intra-classe pour le modèle mixte en (d). Quelle est la signification mathématique de ce coefficient? Comment interprétez-vous de résultat d'un point de vue biologique?


## 2. Indicateurs d'une maladie chez les abeilles

La loque américaine est une maladie infectieuse affectant les colonies d'abeille. Le tableau de données [bees.csv](bees.csv), tiré du manuel de Zuur et al. *Mixed Effects Models and Extensions in Ecology with R*, contient des mesures de la densité de spores bactériennes (`Spobee`) relevée sur 72 abeilles provenant de 24 ruches (`Hive`, 3 abeilles par ruche). 

Nous voulons déterminer la relation entre cette densité de spores et deux variables définies par ruche: le niveau d'infection observé dans la ruche (`Infection`) et un estimé de la taille de la colonie (`BeesN`).

```{r}
bees <- read.csv("bees.csv")
str(bees)
```

(a) Avant de modéliser ces données, effectuez les transformations suivantes.

- Le niveau d'infection est sur une échelle qualitative (0 = pas de symptômes, 1 = infection légere, 2 = modérée et 3 = sévère). Puisque nous avons très peu de ruches pour les différents niveaux d'infection (1 de niveau 1, 1 de niveau 2 et 2 de niveau 3), créez une nouvelle variable binaire `pres_inf` qui indique la présence (niveaux 1 à 3) ou l'absence (niveau 0) d'infection. 

- La distribution de la réponse `Spobee` est très asymétrique. Tel que suggéré par Zuur et al., créez une nouvelle variable en appliquant la fonction `log1p`, équivalente à *log(Spobee + 1)*. Il s'agit d'une transformation logarithmique où on a préalabement ajouté 1 à la réponse, afin d'éviter de prendre le logarithme de 0.

- Exprimez la taille de la colonie en unités de 10 000 abeilles.

(b) Estimez les paramètres d'un modèle mixte pour déterminer l'effet de la présence d'infection et de la taille de la colonie sur la densité de spores (transformée) observée sur les abeilles. Quel effet aléatoire serait approprié pour ce problème?

(c) Utilisez des graphiques de diagnostic pour vérifier les suppositions du modèle, incluant la normalité des effets aléatoires.

(d) Quel est le coefficient de corrélation intra-classe de ce modèle? Pour estimer plus précisément les effets fixes de ce modèle, serait-il préférable d'échantillonner plus de ruches, ou plus d'abeilles par ruche?

(e) Quels sont les intervalles de confiance à 95% des effets fixes dans le modèle mixte? Si on remplaçait ce modèle par une régression linéaire ignorant complètement la variable `Hive`, ces intervalles seraient-ils plus étroits ou plus larges, et pourquoi?
