<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2021-09-08" />

<title>Introduction to R - Part 2</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Introduction to R - Part 2</h1>
<h4 class="date">September 8, 2021</h4>

</div>


<div id="objectives-for-this-part" class="section level1">
<h1>Objectives for this part</h1>
<ul>
<li><p>Load <em>packages</em> to add functions to R.</p></li>
<li><p>Produce graphics with the <em>ggplot2</em> package.</p>
<ul>
<li>Create different types of graphics: point clouds, boxplots, histograms and more.</li>
<li>Create composite graphics.</li>
<li>Customize the appearance of graphical elements.</li>
</ul></li>
<li><p>Manipulate data frames with the <em>dplyr</em> package.</p>
<ul>
<li>Filter and sort observations.</li>
<li>Transform the variables.</li>
<li>Calculate statistics by groups of observations.</li>
<li>Join two tables according to common variables.</li>
</ul></li>
</ul>
</div>
<div id="r-packages" class="section level1">
<h1>R packages</h1>
<ul>
<li><p>A package is a collection of functions developed by R users that increases the basic capabilities of the R language in a certain domain. The CRAN (<a href="https://cran.r-project.org/web/packages/" class="uri">https://cran.r-project.org/web/packages/</a>) package repository currently has more than 12,000!</p></li>
<li><p>To <strong>install</strong> a package on your computer, use the <code>install.packages</code> function with the package name in quotation marks, e.g.<code>install.packages ("ggplot2")</code>. In RStudio, you can view the list of packages already installed under the <em>Packages</em> tab in the lower right quadrant.</p></li>
<li><p>To <strong>load</strong> a package into your current R session and have access to its functions, use the <code>library</code> function, e.g. <code>library(ggplot2)</code>. Note that quotation marks are not required this time.</p></li>
</ul>
</div>
<div id="data-visualization-with-ggplot2" class="section level1">
<h1>Data visualization with <em>ggplot2</em></h1>
<p>There are several ways to produce graphs in R. We will use in this course the <em>ggplot2</em> package, which provides a consistent code structure for multiple types of graphs and offers a wide range of options to customize the appearance of the graphics.</p>
<pre class="r"><code>library(ggplot2)</code></pre>
<div id="create-a-scatter-plot" class="section level2">
<h2>Create a scatter plot</h2>
<p>The <code>msleep</code> dataset included with <em>ggplot2</em> contains data on sleep of 83 mammal species.</p>
<pre class="r"><code>msleep</code></pre>
<pre><code>## # A tibble: 83 x 11
##    name   genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
##    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 Cheet~ Acin~ carni Carn~ lc                  12.1      NA        NA      11.9
##  2 Owl m~ Aotus omni  Prim~ &lt;NA&gt;                17         1.8      NA       7  
##  3 Mount~ Aplo~ herbi Rode~ nt                  14.4       2.4      NA       9.6
##  4 Great~ Blar~ omni  Sori~ lc                  14.9       2.3       0.133   9.1
##  5 Cow    Bos   herbi Arti~ domesticated         4         0.7       0.667  20  
##  6 Three~ Brad~ herbi Pilo~ &lt;NA&gt;                14.4       2.2       0.767   9.6
##  7 North~ Call~ carni Carn~ vu                   8.7       1.4       0.383  15.3
##  8 Vespe~ Calo~ &lt;NA&gt;  Rode~ &lt;NA&gt;                 7        NA        NA      17  
##  9 Dog    Canis carni Carn~ domesticated        10.1       2.9       0.333  13.9
## 10 Roe d~ Capr~ herbi Arti~ lc                   3        NA        NA      21  
## # ... with 73 more rows, and 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>Enter the following code to produce a scatter plot showing the number of hours of the REM phase (<em>sleep_rem</em>) based on the total number of hours of sleep.</p>
<pre class="r"><code>ggplot(data = msleep, mapping = aes(x = sleep_total, y = sleep_rem)) +
    geom_point()</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values (geom_point).</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The graph appears in the <em>Plots</em> tab of the lower right quadrant in RStudio. You can export it in .PNG or .PDF format using the <em>Export</em> menu.</p>
<p>This first example illustrates the basic structure for producing a graph with <em>ggplot2</em>:</p>
<ul>
<li><p>A call to the <code>ggplot</code> function with two arguments:</p>
<ul>
<li>a data frame (<code>data</code>) and</li>
<li>a mapping specified with the <code>aes</code> function. Within this function, we associate elements of the graph with variables in the dataset (eg <em>sleep_total</em> on the <em>x</em> axis).</li>
</ul></li>
<li><p>The <code>+</code> symbol to indicate that we will add other components to the graph.</p></li>
<li><p>A <em>geom</em> function to specify the geometric elements represented (here <code>geom_point</code>, for a scatter plot).</p></li>
</ul>
<blockquote>
<p><strong>Note:</strong> After naming the data frame in the <code>data</code> argument, the <code>aes</code> function only requires the variable names, without quotation marks and without specifying the data frame again (<code>sleep_rem</code> instead of <code>msleep$sleep_rem</code>). This is a special property of the <em>ggplot2</em> package functions, which we will also find with the <em>dplyr</em> package below, as well as with the regression functions later in the lesson.</p>
</blockquote>
</div>
<div id="retour1" class="section level2">
<h2>Exercise 1</h2>
<p>First, load the <a href="cours1_kejimkujik.csv">Kejimkujik National Park Dataset</a> that we used in the first lab:</p>
<pre class="r"><code>kejim &lt;- read.csv(&quot;cours1_kejimkujik.csv&quot;)
head(kejim)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1   BD        A   31    8  2004         1        1   TSCA 16.3
## 2   BD        A   31    8  2004         2        1   TSCA 24.0
## 3   BD        A   31    8  2004         6        1   TSCA 29.8
## 4   BD        A   31    8  2004         7        1   ACRU 29.0
## 5   BD        A   31    8  2004         8        1   TSCA 15.5
## 6   BD        A   31    8  2004         9        1   TSCA 32.0</code></pre>
<p>From this data frame, produce a scatter plot of the DBH (<code>dhp</code>, on the y axis) according to the species (<code>espece</code>, on the x axis).</p>
<p><a href="#sol1">Solution</a></p>
</div>
<div id="types-of-graphics-the-geom-functions" class="section level2">
<h2>Types of graphics: the <em>geom</em> functions</h2>
<p>Here, there are too many trees to see the distribution of DBH by species with a scatter plot. To view the same data with boxplots, just replace <code>geom_point</code> with<code>geom_boxplot</code> in our previous code.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece, y = dhp)) +
    geom_boxplot()</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Multiple <code>geom _...</code> functions can be used to overlay elements on the same graph. So we add the dots to the boxplot, specifying a different color for <code>geom_point</code>.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece, y = dhp)) +
    geom_boxplot() +
    geom_point(color = &quot;red&quot;)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>We can also represent summary statistics of a set of points, such as their mean.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece, y = dhp)) +
    geom_boxplot() +
    geom_point(color = &quot;red&quot;, stat = &quot;summary&quot;, fun = &quot;mean&quot;)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Now, we produce a histogram of the DBH for all trees with <code>geom_histogram</code>. The histogram represents a single variable, so we do not need to specify <em>y</em> in <code>aes</code>.</p>
<pre class="r"><code>ggplot(kejim, aes(x = dhp)) +
    geom_histogram(binwidth = 5, color = &quot;white&quot;, fill = &quot;blue&quot;)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>In the <code>geom_histogram</code> function, we specified several arguments in order to choose the size of the bins (<code>binwith</code>), the color of the border (<code>color</code>) and the fill color of the bars (<code>fill</code>).</p>
<p>Rather than using one fill color for all bars, we could represent different species by bars of different colors on the histogram. In this case, we must associate <code>fill</code> to the variable <code>espece</code> inside the <code>aes</code> function.</p>
<pre class="r"><code>ggplot(kejim, aes(x = dhp, fill = espece)) +
    geom_histogram(binwidth = 5, color = &quot;white&quot;)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="retour2" class="section level2">
<h2>Exercise 2</h2>
<p>With <code>geom_bar</code>, create a bar graph of the number of individuals per species (different species on the x-axis). Use a color code to identify individuals from different sites.</p>
<p><a href="#sol2">Solution</a></p>
</div>
<div id="divide-a-graph-in-facets" class="section level2">
<h2>Divide a graph in facets</h2>
<p>In the exercise, we produced a graph of the number of individuals per species. If we want to visualize separately the distribution of species on different sites, we could divide the data by site and produce several graphs. Fortunately, <em>ggplot2</em> simplifies this task with the facet concept.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece)) +
    geom_bar() +
    facet_wrap(~ site)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Note that you must put a <em>tilde</em> (~) before the name of the variable in <code>facet_wrap</code>.</p>
<p>In the previous graph, species codes are not visible on the <em>x</em> axis. So we add the <code>coord_flip</code> function to invert the axes and produce horizontal bars.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece)) +
    geom_bar() +
    facet_wrap(~ site) +
    coord_flip()</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>We can also create a grid of facets (<code>facet_grid</code>) with two variables. For example, here are histograms of the DBH by site and by year.</p>
<pre class="r"><code>ggplot(kejim, aes(x = dhp)) +
    geom_histogram(binwidth = 5) +
    facet_grid(annee ~ site)</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="retour3" class="section level2">
<h2>Exercise 3</h2>
<p>From the <code>msleep</code> dataset, create a scatter plot of total sleep (<code>sleep_total</code>) and REM sleep (<code>sleep_rem</code>) with one facet for each type of diet (<code>vore</code>).</p>
<p><a href="#sol3">Solution</a></p>
</div>
<div id="customize-the-appearance-of-graphs" class="section level2">
<h2>Customize the appearance of graphs</h2>
<p>All visual aspects of <em>ggplot2</em> graphics can be customized: title and scale of axes, size and font, colors, margins, etc. If the default values of these parameters are sufficient for a quick exploration of the data, the production of figures for publications or presentations requires further adjustments.</p>
<p>Let’s start with a density chart for the DBH of three species (TSCA, ACRU and BEPA). We save this graph in an object (<code>dens</code>) so that we can modify it without rewriting the code of the basic graph.</p>
<pre class="r"><code>trois_esp &lt;- kejim[kejim$espece %in% c(&quot;TSCA&quot;, &quot;ACRU&quot;, &quot;BEPA&quot;), ]

dens &lt;- ggplot(trois_esp, aes(x = dhp, fill = espece)) +
    geom_density(alpha = 0.3)

dens</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>What does the <code>alpha</code> parameter means? Try changing its value.</p>
<p>The title of the chart, axes, and legend are specified with the <code>labs</code> function (for <em>labels</em>).</p>
<pre class="r"><code>dens &lt;- dens +
    labs(title = &quot;Distribution of the diameter of three species at Kejimkujik National Park&quot;, 
         x = &quot;Diameter at breast height (cm)&quot;, y = &quot;Density&quot;, fill = &quot;Species&quot;)
dens</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Functions starting with <code>scale _...</code> let us adjust different elements of the scales represented on the graph. In the following example, we change the values shown on the <em>x</em> axis with the <code>breaks</code> argument of <code>scale_x_continuous</code>. With the <code>scale_fill_manual</code> function, we specify the fill colors for the density curves (<code>values</code>), and then rename the legend elements (<code>labels</code>).</p>
<pre class="r"><code>dens &lt;- dens +
    scale_x_continuous(breaks = seq(10, 80, 10)) +
    scale_fill_manual(values = c(&quot;orange&quot;, &quot;purple&quot;, &quot;green&quot;),
                      labels = c(&quot;Acer rubrum&quot;, &quot;Betula papyrifera&quot;, &quot;Tsuga canadensis&quot;))
dens</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Finally, <em>ggplot2</em> has themes that change the overall appearance of the chart. Here we replace the default theme (with the gray background) with <code>theme_bw</code>.</p>
<pre class="r"><code>dens + 
    theme_bw()</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>In addition to changing the entire theme, you can edit specific theme parameters with the <code>theme</code> function. For example, <code>legend.position</code> indicates where to put the legend relative to <em>x</em> and <em>y</em> (0.7 and 0.5 mean 70% of the way along <em>x</em> and 50% along <em>y</em>).</p>
<pre class="r"><code>dens + 
    theme_bw() +
    theme(legend.position = c(0.7, 0.5))</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The purpose of this part was to give an overview of the possibilities of <em>ggplot2</em>. More complete references on this package are indicated at the bottom of the page.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<ul>
<li><p>The code of a graph is composed of several functions separated by <code>+</code>.</p></li>
<li><p>We start with the <code>ggplot</code> function, which requires two arguments: the data frame, and the association between variables and elements of the graph (with the<code>aes</code> function).</p></li>
<li><p>We then add one or more geometric layers (<code>geom _...</code>) indicating the type of graph (points, lines, bars, histogram, etc.).</p></li>
<li><p>If necessary, we can then modify the appearance of the graph with functions like <code>scale _...</code>, <code>facet _...</code>, <code>labs</code> and<code>theme</code>.</p></li>
</ul>
</div>
</div>
<div id="data-manipulation-with-dplyr" class="section level1">
<h1>Data manipulation with <em>dplyr</em></h1>
<div id="data-organization" class="section level2">
<h2>Data organization</h2>
<p>The <em>dplyr</em> package contains functions that simplify several common operations on data frames in R. These functions are best suited for data frames in a normal form:</p>
<ul>
<li>each row corresponds to an observation and</li>
<li>each column corresponds to a variable.</li>
</ul>
<blockquote>
<p>These criteria are close to the principles of data organization in a relational database (e.g. Access). In addition, the <em>dplyr</em> functions correspond fairly well to basic operations in the SQL database language.</p>
</blockquote>
<p><strong>Question</strong>: What are the variables in the following table, which indicates the number of individuals per site and species? Does it follow the normal form described above?</p>
<pre><code>##   site fir pine birch
## 1    A  35   10    26
## 2    B  24   12    45
## 3    C  51   19     8</code></pre>
<p><strong>Answer</strong>: The last three columns represent the same variable (number of individuals) for different values of the species. A normalized table would then have three columns: site, species, and number.</p>
<pre><code>##   site species number
## 1    A     fir     35
## 2    B     fir     24
## 3    C     fir     51
## 4    A    pine     10
## 5    B    pine     12
## 6    C    pine     19
## 7    A   birch     26
## 8    B   birch     45
## 9    C   birch      8</code></pre>
<p>By formatting your data in this way, it will also be easier to visualize (as we saw in the previous section) and to model in R.</p>
<p>The <em>tidyr</em> package contains functions to automatically convert an array of data between the two formats above. We do not have time to cover this package today, but you can find more information in the references at the bottom of the page.</p>
<p>For this lab, we will use the Kejimkujik National Park dataset, which is already in normal form.</p>
</div>
<div id="select-observations-with-filter" class="section level2">
<h2>Select observations with <em>filter</em></h2>
<p>At the last class, we saw how to choose rows from a data frame according to a given condition. For example, the following code retrieves all rows corresponding to the species <em>ACRU</em> (red maple).</p>
<pre class="r"><code>acru &lt;- kejim[kejim$espece == &quot;ACRU&quot;, ]
head(acru)</code></pre>
<pre><code>##    site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 4    BD        A   31    8  2004         7        1   ACRU 29.0
## 12   BD        A   31    8  2004        15        1   ACRU 42.9
## 13   BD        A   31    8  2004        16        1   ACRU 18.0
## 23   BD        B   26    8  2004         1        1   ACRU 32.5
## 25   BD        B   26    8  2004         4        1   ACRU 29.8
## 34   BD        B   26    8  2004        14        1   ACRU 33.0</code></pre>
<p>Here is the same operation with the function <code>filter</code>.</p>
<pre class="r"><code>library(dplyr)

acru &lt;- filter(kejim, espece == &quot;ACRU&quot;)
head(acru)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1   BD        A   31    8  2004         7        1   ACRU 29.0
## 2   BD        A   31    8  2004        15        1   ACRU 42.9
## 3   BD        A   31    8  2004        16        1   ACRU 18.0
## 4   BD        B   26    8  2004         1        1   ACRU 32.5
## 5   BD        B   26    8  2004         4        1   ACRU 29.8
## 6   BD        B   26    8  2004        14        1   ACRU 33.0</code></pre>
<p>All <em>dplyr</em> functions have the same structure:</p>
<ul>
<li><p>the name of the function indicates the operation to be performed;</p></li>
<li><p>the first argument is the input data frame;</p></li>
<li><p>the other arguments specify the operation (here, the conditions of the filter);</p></li>
<li><p>the function outputs a transformed data frame.</p></li>
</ul>
<p>The benefits of using <em>dplyr</em> will become more clear after seeing many of the functions.</p>
<blockquote>
<p>As in <em>ggplot2</em>, after specifying the data frame as the first argument, the following arguments can simply use the variable names, without quotation marks.</p>
</blockquote>
<p>Multiple filters can be applied at a time by separating the conditions with commas. For example, <code>acru30</code> contains red maple trees with a DBH (<em>dhp</em>) greater than 30 cm.</p>
<pre class="r"><code>acru30 &lt;- filter(kejim, espece == &quot;ACRU&quot;, dhp &gt; 30)
head(acru30)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1   BD        A   31    8  2004        15        1   ACRU 42.9
## 2   BD        B   26    8  2004         1        1   ACRU 32.5
## 3   BD        B   26    8  2004        14        1   ACRU 33.0
## 4   BD        B   26    8  2004        25        1   ACRU 33.8
## 5   CL        A   18    8  2004         7        1   ACRU 39.8
## 6   CL        A   18    8  2004        14        1   ACRU 46.2</code></pre>
</div>
<div id="retour4" class="section level2">
<h2>Exercise 4</h2>
<p>Produce a table of observations for the year 2014, excluding the individuals of the species <em>TSCA</em> (eastern hemlock).</p>
<p><a href="#sol4">Solution</a></p>
</div>
<div id="sort-observations-with-arrange" class="section level2">
<h2>Sort observations with <em>arrange</em></h2>
<p>The <code>arrange</code> function sorts the rows of a data frame according to the value of one or more variables.</p>
<pre class="r"><code>acru_tri_dhp &lt;- arrange(acru, dhp)
head(acru_tri_dhp)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1  CLT        A   13    8  2004        37        1   ACRU 9.20
## 2  CLT        A   13    8  2004        26        1   ACRU 9.25
## 3  CLT        A   13    8  2004        31        1   ACRU 9.40
## 4  CLT        A   20   10  2014        37        1   ACRU 9.50
## 5  CLT        A   14   10  2009        46        1   ACRU 9.70
## 6  CLT        A   14   10  2009        37        1   ACRU 9.80</code></pre>
<p>To sort in descending order, use the <code>desc()</code> function. The following code sorts the data in ascending order of year, then in descending order of DBH.</p>
<pre class="r"><code>acru_tri_an_dhp &lt;- arrange(acru, annee, desc(dhp))
head(acru_tri_an_dhp)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1   CL        B   18    8  2004         7        1   ACRU 48.5
## 2   CL        B   18    8  2004        14        1   ACRU 47.5
## 3   CL        A   18    8  2004        14        1   ACRU 46.2
## 4   BD        A   31    8  2004        15        1   ACRU 42.9
## 5   CL        B   18    8  2004        13        1   ACRU 42.1
## 6   CL        A   18    8  2004         7        1   ACRU 39.8</code></pre>
</div>
<div id="pick-variables-with-select" class="section level2">
<h2>Pick variables with <em>select</em></h2>
<p>The <code>select</code> function selects columns from a data frame based on a comma-separated list of variable names.</p>
<pre class="r"><code>acru_select &lt;- select(acru_tri_dhp, site, annee, dhp)
head(acru_select)</code></pre>
<pre><code>##   site annee  dhp
## 1  CLT  2004 9.20
## 2  CLT  2004 9.25
## 3  CLT  2004 9.40
## 4  CLT  2014 9.50
## 5  CLT  2009 9.70
## 6  CLT  2009 9.80</code></pre>
</div>
<div id="chain-operations-with" class="section level2">
<h2>Chain operations with <code>%&gt;%</code></h2>
<p>We often want to apply a series of operations to a data frame, without keeping the intermediate results. <em>dplyr</em> provides a useful shortcut for this purpose with the <code>%&gt;%</code> (called <em>pipe</em>) operator.</p>
<blockquote>
<p>The keyboard shortcut for %&gt;% in RStudio is Ctrl + Shift + M.</p>
</blockquote>
<p>The <code>%&gt;%</code> operator has the effect of passing the result of a function as the first argument of the following function. For example, three of the operations we did earlier (select ACRU trees, sort by DBH and extract site, year, and DBH) can be combined in the following sequence.</p>
<pre class="r"><code>acru &lt;- kejim %&gt;%
    filter(espece == &quot;ACRU&quot;) %&gt;%
    arrange(dhp) %&gt;%
    select(site, annee, dhp)
    
head(acru)</code></pre>
<pre><code>##   site annee  dhp
## 1  CLT  2004 9.20
## 2  CLT  2004 9.25
## 3  CLT  2004 9.40
## 4  CLT  2014 9.50
## 5  CLT  2009 9.70
## 6  CLT  2009 9.80</code></pre>
<p>The first <code>%&gt;%</code> passes the initial data frame <code>kejim</code> to the <code>filter</code> function, then the chain continues up to the last output, which is assigned to <code>acru</code>.</p>
</div>
<div id="retour5" class="section level2">
<h2>Exercise 5</h2>
<p>Using <code>%&gt;%</code>, produce a table of balsam fir (ABBA) observations with DBH &gt; 15 cm, sorted in chronological order.</p>
<p><a href="#sol5">Solution</a></p>
</div>
<div id="derive-new-variables-with-mutate" class="section level2">
<h2>Derive new variables with <em>mutate</em></h2>
<p>The <code>mutate</code> function creates variables derived from existing columns in the data frame. In this example, we calculate the DBH in millimeters.</p>
<pre class="r"><code>kejim_dhp_mm &lt;- mutate(kejim, dhp_mm = dhp * 10)
head(kejim_dhp_mm)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp dhp_mm
## 1   BD        A   31    8  2004         1        1   TSCA 16.3    163
## 2   BD        A   31    8  2004         2        1   TSCA 24.0    240
## 3   BD        A   31    8  2004         6        1   TSCA 29.8    298
## 4   BD        A   31    8  2004         7        1   ACRU 29.0    290
## 5   BD        A   31    8  2004         8        1   TSCA 15.5    155
## 6   BD        A   31    8  2004         9        1   TSCA 32.0    320</code></pre>
</div>
<div id="compte-summary-statistics-per-group-group_by-and-summarize" class="section level2">
<h2>Compte summary statistics per group: <em>group_by</em> and <em>summarize</em></h2>
<p>These two functions are often used together: <code>group_by</code> divides a data frame into groups according to the value of one or more variables and <code>summarize</code> calculates one or more summary variables for each group. The following example calculates the mean and standard deviation of the DBH by species.</p>
<pre class="r"><code>group_by(kejim, espece) %&gt;%
    summarize(moyDHP = mean(dhp), etDHP = sd(dhp))</code></pre>
<pre><code>## # A tibble: 13 x 3
##    espece moyDHP etDHP
##    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 ABBA     12.2  3.26
##  2 ACPE     12.0  1.71
##  3 ACRU     20.3 10.3 
##  4 BEAL     50.6 23.3 
##  5 BECO     26.2  7.39
##  6 BEPA     21.2  4.98
##  7 FAGR     17.7  7.51
##  8 PIRU     17.3  6.76
##  9 PIST     22.7 15.3 
## 10 POGR     27.1  6.59
## 11 POTR     60.0  2.70
## 12 QURU     24.3  4.80
## 13 TSCA     22.9 15.0</code></pre>
<p><strong>Notes</strong>:</p>
<ul>
<li><p>Among the columns in the input data frame, only those defining the groups are retained by <code>summarize</code>.</p></li>
<li><p>The <code>summarize</code> function is similar to <code>mutate</code>: both create new columns. However, <code>mutate</code> outputs a new value for each row of the input data frame, while <code>summarize</code> outputs a single value per group.</p></li>
</ul>
<p>In addition to <code>mean</code>,<code>summarize</code> accepts any function that calculates a value from a group of values, e.g. <code>sum</code>, <code>min</code>, <code>max</code>, <code>sd</code>, and many others.</p>
<p>To count the number of observations in each group, we only need a single function, <code>count</code>. The following example shows how to count the number of trees by site and year.</p>
<pre class="r"><code>compte_site_annee &lt;- count(kejim, site, annee)
head(compte_site_annee)</code></pre>
<pre><code>##   site annee  n
## 1   BD  2004 45
## 2   BD  2009 42
## 3   BD  2014 44
## 4  CFR  2004 48
## 5  CFR  2009 47
## 6  CFR  2014 45</code></pre>
</div>
<div id="retour6" class="section level2">
<h2>Exercise 6</h2>
<p>Sort the species in <code>kejim</code> in descending order of maximum diameter.</p>
<p><a href="#sol6">Solution</a></p>
</div>
<div id="join-two-data-frames" class="section level2">
<h2>Join two data frames</h2>
<p>The file <code>codes_especes.csv</code> contains a data frame matching species codes from <code>kejim</code> to the species common names in French and English.</p>
<pre class="r"><code>codes_esp &lt;- read.csv(&quot;codes_especes.csv&quot;, encoding = &quot;UTF-8&quot;)
head(codes_esp)</code></pre>
<pre><code>##   espece             nom_espece   species_name
## 1   ABBA          Sapin baumier     Balsam Fir
## 2   ACPE Érable de Pennsylvanie  Striped Maple
## 3   ACRU           Érable rouge      Red Maple
## 4   ACSA         Érable à sucre    Sugar Maple
## 5   ACSP          Érable à épis Mountain Maple
## 6   AMLA            Amélanchier    Indian Pear</code></pre>
<p><strong>Note</strong>: The <code>encoding = "UTF-8"</code> argument is required to properly read diacritic marks in French.</p>
<p>To add these species names to the <code>kejim</code> data frame, we must join the two data frames with <code>inner_join</code>.</p>
<pre class="r"><code>kejim_esp &lt;- inner_join(kejim, codes_esp)</code></pre>
<pre><code>## Joining, by = &quot;espece&quot;</code></pre>
<pre class="r"><code>head(kejim_esp)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp       nom_espece
## 1   BD        A   31    8  2004         1        1   TSCA 16.3 Pruche du Canada
## 2   BD        A   31    8  2004         2        1   TSCA 24.0 Pruche du Canada
## 3   BD        A   31    8  2004         6        1   TSCA 29.8 Pruche du Canada
## 4   BD        A   31    8  2004         7        1   ACRU 29.0     Érable rouge
## 5   BD        A   31    8  2004         8        1   TSCA 15.5 Pruche du Canada
## 6   BD        A   31    8  2004         9        1   TSCA 32.0 Pruche du Canada
##      species_name
## 1 Eastern Hemlock
## 2 Eastern Hemlock
## 3 Eastern Hemlock
## 4       Red Maple
## 5 Eastern Hemlock
## 6 Eastern Hemlock</code></pre>
<p>The concept of a join originates in relational databases. As we can see here, the <code>inner_join</code> function has attached to each row of the first data frame (<code>kejim</code>) the data from a row in the second data frame (<code>codes_esp</code>) that has a matching value in <code>espece</code>. By default, <em>dplyr</em> assumes that the match must be made on columns of the same name, but it is possible to specify otherwise.</p>
<p>Note that the <code>kejim_esp</code> data frame has 1070 rows, 91 fewer than <code>kejim</code>. This is because species codes in <code>kejim</code> are missing from <code>codes_esp</code>. To keep the rows from the first data frame with no match in the second (and add missing values to the species name columns), you must use a different join type, <code>left_join</code>. We do not have time to discuss the different join types, but you can read the <em>dplyr</em> cheatsheet in the footnotes for more information.</p>
</div>
<div id="summary-of-dplyr-functions" class="section level2">
<h2>Summary of <em>dplyr</em> functions</h2>
<table>
<thead>
<tr class="header">
<th>Fonction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter</code></td>
<td>select rows matching certain conditions</td>
</tr>
<tr class="even">
<td><code>arrange</code></td>
<td>sort rows based on the values of specific variables</td>
</tr>
<tr class="odd">
<td><code>select</code></td>
<td>select columns by name</td>
</tr>
<tr class="even">
<td><code>mutate</code></td>
<td>create new variables derived from existing columns</td>
</tr>
<tr class="odd">
<td><code>group_by</code></td>
<td>divide observations into groups based on grouping variables</td>
</tr>
<tr class="even">
<td><code>summarize</code></td>
<td>calculate summaries of multiple observations (often by group)</td>
</tr>
<tr class="odd">
<td><code>inner_join</code></td>
<td>join two data frames based on common variables</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ul>
<li><p><em>R for Data Science</em> (<a href="http://r4ds.had.co.nz" class="uri">http://r4ds.had.co.nz</a>), specifically Chapters 3 (<em>Data Visualisation</em>) and 5 (<em>Data transformation</em>).</p></li>
<li><p>Cheat sheet for <em>dplyr</em>: <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf</a>.</p></li>
<li><p>Cheat sheet for <em>ggplot2</em>: <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf</a>.</p></li>
<li><p>Reference website for all <em>ggplot2</em> functions: <a href="https://ggplot2.tidyverse.org/reference/index.html" class="uri">https://ggplot2.tidyverse.org/reference/index.html</a>.</p></li>
</ul>
</div>
<div id="solutions-to-the-exercises" class="section level1">
<h1>Solutions to the exercises</h1>
<div id="sol1" class="section level2">
<h2>Exercise 1</h2>
<p>From the <code>kejim</code> data frame, produce a scatter plot of the DBH (<code>dhp</code>, on the y axis) according to the species (<code>espece</code>, on the x axis).</p>
<pre class="r"><code>ggplot(data = kejim, mapping = aes(x = espece, y = dhp)) +
    geom_point()</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p><a href="#retour1">Return</a></p>
</div>
<div id="sol2" class="section level2">
<h2>Exercise 2</h2>
<p>With <code>geom_bar</code>, create a bar graph of the number of individuals per species (different species on the x-axis). Use a color code to identify individuals from different sites.</p>
<pre class="r"><code>ggplot(kejim, aes(x = espece, fill = site)) +
    geom_bar()</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p><a href="#retour2">Return</a></p>
</div>
<div id="sol3" class="section level2">
<h2>Exercise 3</h2>
<p>From the <code>msleep</code> dataset, create a scatter plot of total sleep (<code>sleep_total</code>) and REM sleep (<code>sleep_rem</code>) with one facet for each type of diet (<code>vore</code>)</p>
<pre class="r"><code>ggplot(msleep, aes(x = sleep_total, y = sleep_rem)) +
    geom_point() +
    facet_wrap(~ vore)</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values (geom_point).</code></pre>
<p><img src="2E-IntroR_part2_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p><a href="#retour3">Return</a></p>
</div>
<div id="sol4" class="section level2">
<h2>Exercise 4</h2>
<p>Produce a table of observations for the year 2014, excluding the individuals of the species <em>TSCA</em> (eastern hemlock).</p>
<pre class="r"><code>kejim2014 &lt;- filter(kejim, annee == 2014, espece != &quot;TSCA&quot;)
head(kejim2014)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1   BD        A   11    8  2014         4        1   ACRU 38.2
## 2   BD        A   11    8  2014         7        1   ACRU 32.9
## 3   BD        A   11    8  2014        15        1   ACRU 44.3
## 4   BD        A   11    8  2014        16        1   ACRU 18.2
## 5   BD        B   11    8  2014         1        1   ACRU 33.9
## 6   BD        B   11    8  2014         3        1   PIRU  9.8</code></pre>
<p><a href="#retour4">Return</a></p>
</div>
<div id="sol5" class="section level2">
<h2>Exercise 5</h2>
<p>Using <code>%&gt;%</code>, produce a table of balsam fir (ABBA) observations with DBH &gt; 15 cm, sorted in chronological order.</p>
<pre class="r"><code>kejim %&gt;%
    filter(espece == &quot;ABBA&quot;, dhp &gt; 15) %&gt;%
    arrange(annee, mois, jour)</code></pre>
<pre><code>##   site parcelle jour mois annee num_arbre nb_tiges espece  dhp
## 1  CLT        A   13    8  2004        35        1   ABBA 18.8
## 2   CL        A   18    8  2004         8        1   ABBA 15.1
## 3  CLT        A   14   10  2009        35        1   ABBA 22.9
## 4   CL        A   21   10  2009         8        1   ABBA 15.3
## 5  CLT        B   20   10  2014        10        1   ABBA 15.2</code></pre>
<p><a href="#retour5">Return</a></p>
</div>
<div id="sol6" class="section level2">
<h2>Exercise 6</h2>
<p>Sort the species in <code>kejim</code> in descending order of maximum diameter.</p>
<pre class="r"><code>group_by(kejim, espece) %&gt;%
    summarize(maxDHP = max(dhp)) %&gt;%
    arrange(desc(maxDHP))</code></pre>
<pre><code>## # A tibble: 13 x 2
##    espece maxDHP
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 PIST     84.1
##  2 BEAL     82.7
##  3 TSCA     78.9
##  4 POTR     62.8
##  5 ACRU     52.3
##  6 PIRU     42.5
##  7 POGR     40.4
##  8 BECO     37  
##  9 BEPA     36.7
## 10 QURU     35.6
## 11 FAGR     35.1
## 12 ABBA     22.9
## 13 ACPE     14.1</code></pre>
<p><a href="#retour6">Return</a></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
