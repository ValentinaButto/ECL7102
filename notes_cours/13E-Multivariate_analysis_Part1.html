<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Multivariate analysis, Part 1</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Multivariate analysis, Part 1</h1>
<h4 class="date"><em><br/>December 3, 2018</em></h4>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li><p>Describe different roles of multivariate analysis techniques.</p></li>
<li><p>Describe the usefulness of ordination and clustering methods to reduce the dimensionality of a dataset.</p></li>
<li><p>Execute a principal component analysis and be able to interpret the results.</p></li>
<li><p>Divide observations into classes using hierarchical clustering methods.</p></li>
</ul>
</div>
<div id="why-multivariate-analysis" class="section level1">
<h1>Why multivariate analysis?</h1>
<p>Multivariate analysis aims to model the <em>joint distribution</em> of several variables, that is, the variation of individual variables and the correlations between them.</p>
<p>Here are some situations where these methods might be useful:</p>
<ul>
<li><p>The response we want to explain is multivariate. For example, the composition of an ecological community is defined as the presence or abundance of several species at different sites. Interactions between species (e.g. competition) make it impossible to study this response as the combination of several independent univariate responses (one species at a time).</p></li>
<li><p>We want to explain a univariate response according to a large number of predictors that are partially correlated. For example, the presence of a species depending on climatic conditions, the growth of trees of different species on a site depending on their functional traits, etc. In previous classes on regression, we have seen that it is difficult to estimate the effect of a large number of potentially correlated predictors in the same model. Model selection is also complicated when the number of predictors is large.</p></li>
<li><p>As part of an exploratory analysis of the data, we might want to summarize the differences between observations (e.g. individuals, sites) according to several variables in a single graph, rather than having to look at a scatter plot for each pair of variables.</p></li>
</ul>
</div>
<div id="structure-of-multivariate-data" class="section level1">
<h1>Structure of multivariate data</h1>
<p>Suppose we make <span class="math inline">\(n\)</span> observations of <span class="math inline">\(p\)</span> variables. We represent these observations by a matrix where <span class="math inline">\(x_ {ij}\)</span> is the value of the variable <span class="math inline">\(j\)</span> for the observation <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[  
\begin{bmatrix}
x_{11} &amp; x_{12} &amp; ... &amp; x_{1p} \\
x_{21} &amp; x_{22} &amp; ... &amp; x_{2p} \\
... &amp; ... &amp; ... &amp; ... \\
x_{n1} &amp; ... &amp; ... &amp; x_{np}
\end{bmatrix}
\]</span></p>
<p>As an example, let’s consider the <a href="../donnees/cities_climate.csv">cities_climate.csv</a> dataset, which contains climatic data from WorldClim for 49 major cities.</p>
<pre class="r"><code>villes &lt;- read.csv(&quot;../donnees/cities_climate.csv&quot;)
head(villes)</code></pre>
<pre><code>##       city    long    lat t_mean t_diu  t_sd t_max t_min p_ann p_max p_min
## 1    Tokyo 139.751 35.685   15.6   7.9 7.492  30.7   0.7  1428   185    47
## 2 Shanghai 121.400 31.046   16.2   7.4 8.339  31.6   0.8  1050   167    41
## 3   Mumbai  72.826 18.975   26.8   7.3 1.767  32.7  18.9  2370   827     0
## 4  Karachi  67.082 24.906   25.9   9.9 4.035  34.2  12.0   194    82     0
## 5    Delhi  77.217 28.667   25.1  13.1 6.715  40.5   7.3   734   274     3
## 6   Manila 120.982 14.604   27.3   8.0 1.078  33.8  21.4  2150   466     8
##   p_cv
## 1   40
## 2   46
## 3  143
## 4  134
## 5  142
## 6   90</code></pre>
<p>Here is the list of climate variables in this data frame:</p>
<ul>
<li><em>t_mean</em>: Mean annual temperature.</li>
<li><em>t_diu</em>: Diurnal temperature variation, the mean difference between the maximum and minimum temperature in the same month.</li>
<li><em>t_sd</em>: Seasonal temperature variation, standard deviation of mean temperature between months.</li>
<li><em>t_max</em>: Maximum temperature of the hottest month.</li>
<li><em>t_min</em>: Minimum temperature of the coldest month.</li>
<li><em>p_ann</em>: Annual precipitation.</li>
<li><em>p_max</em>: Precipitation of the wettest month.</li>
<li><em>p_min</em>: Precipitation of the driest month.</li>
<li><em>p_cv</em>: Coefficient of variation (standard deviation / mean) of precipitation between months.</li>
</ul>
<p>All temperatures are in degrees C and all precipitation variables (except coefficient of variation) are in mm.</p>
<p>We will extract the climatic variables in a separate data frame, then add row names to indicate the city names.</p>
<pre class="r"><code>climat &lt;- villes[, 4:12]
rownames(climat) &lt;- villes$city</code></pre>
<p>In a multivariate analysis context, we will treat our 49 observations as “points” in a 9-dimensional space (one dimension for each variable).</p>
<div id="standardization-of-variables" class="section level2">
<h2>Standardization of variables</h2>
<p>The ordination and clustering methods we will see in this course are based on the concept of <em>distance</em> between points in this multidimensional space. However, we cannot calculate these distances if the units differ between the variables: for example, we cannot say whether a variation of temperature of a degree C is more or less important than a variation of precipitation of one mm.</p>
<p>For this reason, we begin by standardizing our variables. When applied to a data frame where all variables are numeric, the <code>scale</code> function transforms each variable by subtracting its mean and dividing by its standard deviation.</p>
<pre class="r"><code>clim_norm &lt;- scale(climat)
round(head(clim_norm), 2) # Only show two digits after decimal</code></pre>
<pre><code>##          t_mean t_diu  t_sd t_max t_min p_ann p_max p_min  p_cv
## Tokyo     -0.44 -0.77  0.91  0.07 -0.62  0.66 -0.06  0.78 -0.74
## Shanghai  -0.36 -0.96  1.17  0.24 -0.61  0.08 -0.17  0.58 -0.59
## Mumbai     1.17 -1.00 -0.86  0.46  1.14  2.12  3.86 -0.81  1.84
## Karachi    1.04  0.01 -0.16  0.74  0.47 -1.24 -0.69 -0.81  1.62
## Delhi      0.93  1.24  0.67  1.95  0.02 -0.41  0.48 -0.71  1.82
## Manila     1.25 -0.73 -1.07  0.67  1.39  1.78  1.66 -0.54  0.52</code></pre>
<p>The result is a <em>matrix</em> where each column has a mean of 0 and a standard deviation of 1. For example, in Tokyo the mean temperature is 0.44 standard deviations below the mean of the 49 cities, whereas the annual precipitation is 0.66 standard deviations above the mean of cities.</p>
<p><strong>Note</strong></p>
<p>You can check that the standard deviation of each column is 1 with the <code>apply</code> function:</p>
<pre class="r"><code>apply(clim_norm, 2, sd)</code></pre>
<pre><code>## t_mean  t_diu   t_sd  t_max  t_min  p_ann  p_max  p_min   p_cv 
##      1      1      1      1      1      1      1      1      1</code></pre>
<p>To understand this command, it is easier to read it backwards. The <code>apply(clim_norm, 2, sd)</code> command says to apply the standard deviation function <code>sd</code> to each column (the number 2 means column, the number 1 means row) of the <code>clim_norm</code> matrix.</p>
<p>There are shortcuts in R to calculate the sum or mean of the rows or columns of a matrix: <code>rowSums</code>, <code>colSums</code>, <code>rowMeans</code>, and <code>colMeans</code>.</p>
</div>
<div id="dimensionality-reduction" class="section level2">
<h2>Dimensionality reduction</h2>
<p>It is not possible to visualize a scatter of points in 9 dimensions. From an exploratory point of view, we would like to be able to reduce the dimensionality of our data while keeping as much information as possible on climate variation between cities. This class aims to provide an introduction to two types of methods for performing this reduction.</p>
<ul>
<li><p><strong>Ordination </strong> methods perform a transformation of the original <span class="math inline">\(p\)</span> variables into a smaller number of new variables, so that the representation of the points in the reduced space (often in 2 dimensions) reproduces as closely as possible the distances between the points in the original <span class="math inline">\(p\)</span>-dimensional space. These methods order observations according to the most important axes of variation, hence their name. <strong>Principal component analysis</strong>, discussed below, is an example of an ordination method.</p></li>
<li><p>If ordination aims to represent the original numeric variables by a reduced number of transformed numeric variables, clustering methods attempt instead to divide the observations into a discrete number of groups (or categories) according to their proximity in the <span class="math inline">\(p\)</span>-dimensional space. The clustering method we will see in this class is <strong>agglomerative hierarchical clustering</strong>.</p></li>
</ul>
</div>
</div>
<div id="principal-component-analysis" class="section level1">
<h1>Principal component analysis</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Here is a scatter plot representing three of the climate variables for the 49 cities: mean temperature, standard deviation of temperature, and annual precipitation.</p>
<div id="htmlwidget-c343f2aa86d1bbce3254" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-c343f2aa86d1bbce3254">{"x":{"visdat":{"bf868eae":["function () ","plotlyVisDat"]},"cur_data":"bf868eae","attrs":{"bf868eae":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","size":1,"inherit":true},"bf868eae.1":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"text":{},"type":"scatter3d","mode":"text","size":0.5,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"t_mean"},"yaxis":{"title":"t_sd"},"zaxis":{"title":"p_ann"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[15.6,16.2,26.8,25.9,25.1,27.3,4.9,10.9,18.2,14,27,15.8,27.5,12,25.6,21.4,18.8,12.1,11,11.4,25.9,24,23.1,22.7,28,14.7,7.9,27.3,17.6,4.9,18.3,14.8,26.7,17.7,26.8,25.4,27.4,16.6,9,6.5,14.1,12.1,24.4,15.2,18.4,24.7,15.7,25.7,11.3],"y":[7.492,8.339,1.767,4.035,6.715,1.078,9.803,10.167,2.137,6.292,1.09,2.039,0.43,8.775,1.333,5.242,2.659,10.686,4.943,0.324,3.667,7.331,1.969,8.704,1.329,4.373,9.543,1.485,3.668,8.937,3.509,3.768,1.055,3.705,0.446,7.128,0.999,2.941,6.918,10.737,6.672,8.676,2.336,1.139,1.205,2.499,5.805,1.086,5.687],"z":[1428,1050,2370,194,734,2150,679,1420,1388,759,1672,641,1949,1150,1370,20,15,608,627,994,1979,608,1255,159,1457,355,793,2465,1275,636,394,656,1790,411,2363,111,1822,885,574,965,437,330,440,1156,935,461,788,1506,633],"type":"scatter3d","mode":"markers","marker":{"color":"rgba(31,119,180,1)","size":[100],"sizemode":"area","line":{"color":"rgba(31,119,180,1)"}},"textfont":{"size":100},"error_y":{"color":"rgba(31,119,180,1)","width":100},"error_x":{"color":"rgba(31,119,180,1)","width":100},"line":{"color":"rgba(31,119,180,1)","width":100},"frame":null},{"x":[15.6,16.2,26.8,25.9,25.1,27.3,4.9,10.9,18.2,14,27,15.8,27.5,12,25.6,21.4,18.8,12.1,11,11.4,25.9,24,23.1,22.7,28,14.7,7.9,27.3,17.6,4.9,18.3,14.8,26.7,17.7,26.8,25.4,27.4,16.6,9,6.5,14.1,12.1,24.4,15.2,18.4,24.7,15.7,25.7,11.3],"y":[7.492,8.339,1.767,4.035,6.715,1.078,9.803,10.167,2.137,6.292,1.09,2.039,0.43,8.775,1.333,5.242,2.659,10.686,4.943,0.324,3.667,7.331,1.969,8.704,1.329,4.373,9.543,1.485,3.668,8.937,3.509,3.768,1.055,3.705,0.446,7.128,0.999,2.941,6.918,10.737,6.672,8.676,2.336,1.139,1.205,2.499,5.805,1.086,5.687],"z":[1428,1050,2370,194,734,2150,679,1420,1388,759,1672,641,1949,1150,1370,20,15,608,627,994,1979,608,1255,159,1457,355,793,2465,1275,636,394,656,1790,411,2363,111,1822,885,574,965,437,330,440,1156,935,461,788,1506,633],"text":["Tokyo","Shanghai","Mumbai","Karachi","Delhi","Manila","Moscow","Seoul","Sao Paulo","Istanbul","Lagos","Mexico","Jakarta","New York","Kinshasa","Cairo","Lima","Beijing","London","Bogota","Dhaka","Lahore","Rio de Janeiro","Baghdad","Bangkok","Santiago","Toronto","Rangoon","Sydney","Saint Petersburg","Los Angeles","Melbourne","Abidjan","Casablanca","Singapore","Riyadh","Ho Chi Minh City","Cape Town","Berlin","Montreal","Madrid","Kabul","Luanda","Addis Abeba","Nairobi","Dakar","Rome","Santo Domingo","Paris"],"type":"scatter3d","mode":"text","marker":{"color":"rgba(255,127,14,1)","size":[10],"sizemode":"area","line":{"color":"rgba(255,127,14,1)"}},"textfont":{"size":10},"error_y":{"color":"rgba(255,127,14,1)","width":10},"error_x":{"color":"rgba(255,127,14,1)","width":10},"line":{"color":"rgba(255,127,14,1)","width":10},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>The position of the points on the screen represents the projection of the 3D scatter of points on a 2D image. By rotating the graph, this projection changes even if the value of the points remains the same for the three variables. Some rotations make it easier to differentiate the points than others, even if none perfectly reproduces the distances between every pair of points. Mathematically, these rotations are a linear transformation of the original variables into a new three-dimensional space composed of the width, the height and the depth of the screen; the variation according to this third dimension (depth) is of course hidden in the visualization.</p>
<p>Consider the extreme case where we have three variables <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> and <span class="math inline">\(z\)</span> and one of them is perfectly predicted by the other two (perfect collinearity), for example <span class="math inline">\(z = 2x - 5y\)</span>. The set of points is located on a single plane, but the axes of this plane correspond to a linear combination of the original variables. A rotation would align this plane with the first two dimensions of the visualization (width and height). In this case, since the data do not vary in the third dimension, the projection perfectly represents the variation of the original data.</p>
<div id="htmlwidget-0b6731d69d6bdac7264b" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b6731d69d6bdac7264b">{"x":{"visdat":{"bf82c931d41":["function () ","plotlyVisDat"]},"cur_data":"bf82c931d41","attrs":{"bf82c931d41":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","size":1,"inherit":true},"bf82c931d41.1":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"mesh3d","opacity":0.3,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"x"},"yaxis":{"title":"y"},"zaxis":{"title":"z"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[0.716004952877276,1.6293981847554,0.0594004618893521,0.616295567396075,-0.847826001893332,-1.71605262750609,-0.862238587374162,0.288781547885002,1.04487352584718,-1.03087117080695,-0.754377940421288,-0.964861250010435,-0.538450036417103,-0.0349404142826624,-1.68894065501478,0.348637899710291,-0.522875142766624,-0.132129175983023,-1.81782718050662,-0.356574020257893,2.31883377185905,-1.42876604770113,-0.671340607766228,1.30998976235664,-1.20694727599202,-1.58538969739211,-0.467079114820689,0.483938150480368,-0.407039182402902,-2.33063248806853,0.493250944818003,-1.10306366929676,-0.697644941425873,1.50548600882972,0.169791324961076,-0.782057842619777,1.13741537952101,-0.241377624666743,0.525145891497932,1.41996444363504,1.29043776729975,-1.23377808805421,0.67553477506451,0.347049973772475,-0.605000142597397,-0.624236360804754,-0.421128635823029,-0.759542985109718,-1.53377892870821,0.377868123521718,-0.786627329652717,0.171862666973386,-0.309711613992102,-0.318706012097182,1.16258571677109,1.19249149867682,-0.183620101689502,-0.794497386656217,1.16937445375232,1.01198738468866,-1.47010089800741,2.66720493381672,-1.93909413583941,-1.05819296191855,-1.46194445833089,0.702103501379019,-0.660973485276643,0.773052119639506,-1.84518482576185,0.21965466695053,-0.99188403287298,-1.26740855486502,0.507933297408054,1.05857256142289,0.996218969942731,0.622928020241551,0.978259734017258,-2.29153161262758,3.76601037401562,0.456810426942328,0.910976595663934,-1.1990644495502,-0.32944473459326,-1.415294957781,1.26805569368261,-0.144663221673955,-0.242901857732607,1.48867900919308,-0.213552154886264,1.32207333455257,0.412661269965784,-1.25990188599325,-0.674913490787251,0.573081025510447,0.637568132286022,1.2030360196809,1.22639135151864,0.0150146006011232,0.859779129857686,0.840603633532201],"y":[0.28444017315454,-0.853930570780402,0.625801616964488,0.524464035127578,-0.0484497156649512,-1.72126156900901,-0.228526919056355,0.159737843627539,-2.47011570916701,-0.587448215990647,-0.571877773992911,1.00492520251266,0.211044591585873,-1.73398944023114,0.658912510630747,-0.330007678827724,-0.627482779261994,1.7186419339207,0.376376269168572,0.0846115162741227,1.148942331756,0.195071743867756,-1.22692549646288,-0.528142555873371,1.2593523634191,0.607050230029827,-0.356448668262492,0.357517437616524,0.97143557123481,0.439201943469963,-1.10701828971916,0.443939383254244,0.655892821875828,-0.512323933686235,-1.45070915179687,-0.411528857457742,-0.64091406129953,-0.661127312477198,1.35726812728635,-0.821156735073342,-0.00734263083869651,-2.5305766487674,-0.202760757586219,1.49692061063559,-1.22537545393305,-0.626685838573129,-0.300087440298862,-0.562901339952365,0.309314309011666,1.37393039436444,-0.385803823445331,0.582655374751965,-0.765868460298628,1.9289954285121,1.63219573313873,0.164078253931016,-0.11206603188563,0.38528984236944,0.0935819901659033,-1.12008996103854,-0.362836599952254,-0.672390939016426,0.785946315065815,-1.73936078279793,-0.757362675208019,0.0535933426339193,-1.58091453785266,-0.0784218639555836,-0.0740321031674312,0.626757970817707,0.541272912100097,0.76179008204613,-0.759944639869514,0.707299718555172,0.71547491249056,-0.148194781361794,0.766732999638382,0.195402220713932,0.123075913258734,0.551362321033707,0.023509022214081,-1.53300956071815,0.103284341296189,-0.608495855257442,-0.164077372208315,-0.208158747385186,-0.379924156793857,-1.06226625779311,-0.0880594181589428,0.620746754777839,1.44608392407354,1.72147393257581,2.17177807316933,1.29846767748373,1.51696266676211,-0.608237449311107,1.56644494106095,0.865508034879246,0.893474301541251,2.33861209373565],"z":[0.00980903998185068,7.5284492234128,-3.01020716104374,-1.38972904084574,-1.45340342546191,5.17420259003289,-0.581842579466552,-0.221126122367691,14.4403255975294,0.875498738339344,1.35063298912198,-6.95434851258416,-2.13212303076357,8.60006637259036,-6.67244386318329,2.3473141935592,2.09166361077672,-8.85746802156953,-5.51753570685609,-1.1362056218864,-1.1070441150619,-3.83289081474104,4.79194626678194,5.26069230408014,-8.71065636907952,-6.20603054493336,0.84808511167108,-0.819710887121885,-5.67125622097985,-6.85727469348688,6.52159333823179,-4.42582425486473,-4.67475399223089,5.57259168609061,7.5931284089065,0.493528602049156,5.47940106553966,2.8228813130525,-5.73604885343587,6.9457125626368,2.61758868879298,10.1853270677286,2.36487333806012,-6.790503105633,4.91687698447045,1.88495647125614,0.658179929848253,1.29542072954239,-4.61412940247474,-6.11391572477878,0.35576445792122,-2.56955153981305,3.20991907350894,-10.2823891667549,-5.83580723215145,1.56459172769857,0.193089956049144,-3.51544398515963,1.87083895667513,7.62442457457004,-1.12601879625354,8.69636456271558,-7.8079198470079,6.58041799015254,0.862924459378313,1.13624028958844,6.58262571870999,1.93821355905693,-3.32020913568655,-2.69448052018747,-4.69013262624644,-6.34376751996069,4.81558979416368,-1.41935346993008,-1.58493662256734,1.98682994729207,-1.87714553015739,-5.56007432882482,6.91664118173758,-1.84319075128388,1.70440808025746,5.26691890449033,-1.17531117566746,0.211889360725203,3.3564982484068,0.751467293578018,1.41381706850407,8.28868930735171,0.0131927810221851,-0.459587104784057,-6.40509708043613,-11.1271734348655,-12.2087173474212,-5.34617633639777,-6.30967706923849,5.44725928591733,-5.37944200226746,-4.29751097319398,-2.74781324799088,-10.0118532016139],"type":"scatter3d","mode":"markers","marker":{"color":"rgba(31,119,180,1)","size":[55],"sizemode":"area","line":{"color":"rgba(31,119,180,1)"}},"textfont":{"size":55},"error_y":{"color":"rgba(31,119,180,1)","width":55},"error_x":{"color":"rgba(31,119,180,1)","width":55},"line":{"color":"rgba(31,119,180,1)","width":55},"frame":null},{"colorbar":{"title":"z<br />z","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.126443594592629","rgba(71,45,122,1)"],["0.201438211570555","rgba(65,68,134,1)"],["0.220560781812054","rgba(62,74,137,1)"],["0.241013882483329","rgba(61,79,138,1)"],["0.25432396277545","rgba(60,83,138,1)"],["0.28441666040932","rgba(56,91,140,1)"],["0.324724325989483","rgba(51,102,142,1)"],["0.357019831702302","rgba(48,110,142,1)"],["0.390175676616447","rgba(45,117,142,1)"],["0.407991866549568","rgba(43,121,142,1)"],["0.420631360608044","rgba(42,124,142,1)"],["0.454164858048739","rgba(38,132,142,1)"],["0.46945508211072","rgba(38,136,141,1)"],["0.489047506564898","rgba(37,141,140,1)"],["0.505993425348293","rgba(36,145,139,1)"],["0.522087245550214","rgba(35,149,139,1)"],["0.533176802333948","rgba(34,152,138,1)"],["0.558280056173575","rgba(32,159,137,1)"],["0.638279204701953","rgba(49,177,125,1)"],["0.655652924864871","rgba(52,180,123,1)"],["0.68949699634829","rgba(68,187,115,1)"],["0.718493422236055","rgba(84,193,107,1)"],["0.766045279950409","rgba(104,203,93,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"x":[0.716004952877276,1.6293981847554,0.0594004618893521,0.616295567396075,-0.847826001893332,-1.71605262750609,-0.862238587374162,0.288781547885002,1.04487352584718,-1.03087117080695,-0.754377940421288,-0.964861250010435,-0.538450036417103,-0.0349404142826624,-1.68894065501478,0.348637899710291,-0.522875142766624,-0.132129175983023,-1.81782718050662,-0.356574020257893,2.31883377185905,-1.42876604770113,-0.671340607766228,1.30998976235664,-1.20694727599202,-1.58538969739211,-0.467079114820689,0.483938150480368,-0.407039182402902,-2.33063248806853,0.493250944818003,-1.10306366929676,-0.697644941425873,1.50548600882972,0.169791324961076,-0.782057842619777,1.13741537952101,-0.241377624666743,0.525145891497932,1.41996444363504,1.29043776729975,-1.23377808805421,0.67553477506451,0.347049973772475,-0.605000142597397,-0.624236360804754,-0.421128635823029,-0.759542985109718,-1.53377892870821,0.377868123521718,-0.786627329652717,0.171862666973386,-0.309711613992102,-0.318706012097182,1.16258571677109,1.19249149867682,-0.183620101689502,-0.794497386656217,1.16937445375232,1.01198738468866,-1.47010089800741,2.66720493381672,-1.93909413583941,-1.05819296191855,-1.46194445833089,0.702103501379019,-0.660973485276643,0.773052119639506,-1.84518482576185,0.21965466695053,-0.99188403287298,-1.26740855486502,0.507933297408054,1.05857256142289,0.996218969942731,0.622928020241551,0.978259734017258,-2.29153161262758,3.76601037401562,0.456810426942328,0.910976595663934,-1.1990644495502,-0.32944473459326,-1.415294957781,1.26805569368261,-0.144663221673955,-0.242901857732607,1.48867900919308,-0.213552154886264,1.32207333455257,0.412661269965784,-1.25990188599325,-0.674913490787251,0.573081025510447,0.637568132286022,1.2030360196809,1.22639135151864,0.0150146006011232,0.859779129857686,0.840603633532201],"y":[0.28444017315454,-0.853930570780402,0.625801616964488,0.524464035127578,-0.0484497156649512,-1.72126156900901,-0.228526919056355,0.159737843627539,-2.47011570916701,-0.587448215990647,-0.571877773992911,1.00492520251266,0.211044591585873,-1.73398944023114,0.658912510630747,-0.330007678827724,-0.627482779261994,1.7186419339207,0.376376269168572,0.0846115162741227,1.148942331756,0.195071743867756,-1.22692549646288,-0.528142555873371,1.2593523634191,0.607050230029827,-0.356448668262492,0.357517437616524,0.97143557123481,0.439201943469963,-1.10701828971916,0.443939383254244,0.655892821875828,-0.512323933686235,-1.45070915179687,-0.411528857457742,-0.64091406129953,-0.661127312477198,1.35726812728635,-0.821156735073342,-0.00734263083869651,-2.5305766487674,-0.202760757586219,1.49692061063559,-1.22537545393305,-0.626685838573129,-0.300087440298862,-0.562901339952365,0.309314309011666,1.37393039436444,-0.385803823445331,0.582655374751965,-0.765868460298628,1.9289954285121,1.63219573313873,0.164078253931016,-0.11206603188563,0.38528984236944,0.0935819901659033,-1.12008996103854,-0.362836599952254,-0.672390939016426,0.785946315065815,-1.73936078279793,-0.757362675208019,0.0535933426339193,-1.58091453785266,-0.0784218639555836,-0.0740321031674312,0.626757970817707,0.541272912100097,0.76179008204613,-0.759944639869514,0.707299718555172,0.71547491249056,-0.148194781361794,0.766732999638382,0.195402220713932,0.123075913258734,0.551362321033707,0.023509022214081,-1.53300956071815,0.103284341296189,-0.608495855257442,-0.164077372208315,-0.208158747385186,-0.379924156793857,-1.06226625779311,-0.0880594181589428,0.620746754777839,1.44608392407354,1.72147393257581,2.17177807316933,1.29846767748373,1.51696266676211,-0.608237449311107,1.56644494106095,0.865508034879246,0.893474301541251,2.33861209373565],"z":[0.00980903998185068,7.5284492234128,-3.01020716104374,-1.38972904084574,-1.45340342546191,5.17420259003289,-0.581842579466552,-0.221126122367691,14.4403255975294,0.875498738339344,1.35063298912198,-6.95434851258416,-2.13212303076357,8.60006637259036,-6.67244386318329,2.3473141935592,2.09166361077672,-8.85746802156953,-5.51753570685609,-1.1362056218864,-1.1070441150619,-3.83289081474104,4.79194626678194,5.26069230408014,-8.71065636907952,-6.20603054493336,0.84808511167108,-0.819710887121885,-5.67125622097985,-6.85727469348688,6.52159333823179,-4.42582425486473,-4.67475399223089,5.57259168609061,7.5931284089065,0.493528602049156,5.47940106553966,2.8228813130525,-5.73604885343587,6.9457125626368,2.61758868879298,10.1853270677286,2.36487333806012,-6.790503105633,4.91687698447045,1.88495647125614,0.658179929848253,1.29542072954239,-4.61412940247474,-6.11391572477878,0.35576445792122,-2.56955153981305,3.20991907350894,-10.2823891667549,-5.83580723215145,1.56459172769857,0.193089956049144,-3.51544398515963,1.87083895667513,7.62442457457004,-1.12601879625354,8.69636456271558,-7.8079198470079,6.58041799015254,0.862924459378313,1.13624028958844,6.58262571870999,1.93821355905693,-3.32020913568655,-2.69448052018747,-4.69013262624644,-6.34376751996069,4.81558979416368,-1.41935346993008,-1.58493662256734,1.98682994729207,-1.87714553015739,-5.56007432882482,6.91664118173758,-1.84319075128388,1.70440808025746,5.26691890449033,-1.17531117566746,0.211889360725203,3.3564982484068,0.751467293578018,1.41381706850407,8.28868930735171,0.0131927810221851,-0.459587104784057,-6.40509708043613,-11.1271734348655,-12.2087173474212,-5.34617633639777,-6.30967706923849,5.44725928591733,-5.37944200226746,-4.29751097319398,-2.74781324799088,-10.0118532016139],"type":"mesh3d","opacity":0.3,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>It is rare for variables to be perfectly collinear, so the dimensionality reduction will always be associated with a loss of information; the goal of ordination is to specifically choose the new axes in order to minimize the variation of the data in the dimensions that will be eliminated, or in an equivalent way, to maximize the variation “explained” by the selected axes.</p>
</div>
<div id="how-principal-component-analysis-works" class="section level2">
<h2>How principal component analysis works</h2>
<p>Consider a multivariate data set <span class="math inline">\(X\)</span>, a matrix of <span class="math inline">\(n\)</span> observations of <span class="math inline">\(p\)</span> variables, and assume that these variables have been previously standardized. Principal component analysis (PCA) is a linear transformation of the matrix <span class="math inline">\(X\)</span> (equivalent to a rotation in <span class="math inline">\(p\)</span> dimensions) determined as follows:</p>
<ul>
<li>the first axis (first new variable) is chosen so as to maximize the variance of the data along this axis;</li>
<li>the second axis is chosen so as to maximize the variance of the data provided that it is orthogonal (perpendicular) to the first axis;</li>
<li>the third axis is chosen so as to maximize the variance of the data provided that it is orthogonal to the two previous ones;</li>
<li>and so on.</li>
</ul>
<p>The transformed variables, or principal components, obtained by PCA thus have the property of being orthognal to each other (which means in particular that their correlation is 0) and of being listed in descending order of explained variance.</p>
<p>Mathematically, PCA requires the calculation of the eigenvalues and eigenvectors of the covariance matrix of <span class="math inline">\(X\)</span>, <span class="math inline">\(C_X\)</span>. An element of this matrix <span class="math inline">\(C_{X ~ i,j}\)</span> corresponds to the covariance between the columns (variables) <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> of <span class="math inline">\(X\)</span>. The eigenvectors indicate the direction of the principal components whereas the eigenvalues indicate the variance of the data according to each principal component.</p>
<p>The development of PCA is based on the theory of multivariate normal distributions and the method works best when the variables approach normality. In practice, it is enough to transform very asymmetric variables in order to avoid that certain extreme values have an excessive influence on the analysis.</p>
<p>In the next class, we will see ordination methods that are adapted to the species presence-absence and abundance data common in ecology.</p>
</div>
<div id="pca-with-r" class="section level2">
<h2>PCA with R</h2>
<p>There are several functions to perform PCA in R. In this course, we will use the <code>prcomp</code> function.</p>
<p><strong>Note</strong>: If we had not standardized the variables beforehand, we can do it directly in the <code>prcomp</code> function with the argument <code>scale. = TRUE</code>.</p>
<pre class="r"><code>clim_acp &lt;- prcomp(clim_norm)
summary(clim_acp)</code></pre>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5     PC6
## Standard deviation     1.9785 1.5741 0.9774 0.90767 0.75003 0.46655
## Proportion of Variance 0.4349 0.2753 0.1061 0.09154 0.06251 0.02418
## Cumulative Proportion  0.4349 0.7102 0.8164 0.90792 0.97042 0.99461
##                            PC7     PC8     PC9
## Standard deviation     0.20003 0.08141 0.04355
## Proportion of Variance 0.00445 0.00074 0.00021
## Cumulative Proportion  0.99905 0.99979 1.00000</code></pre>
<p>The summary of PCA results first shows the standard deviation of each of the 9 principal components (rotation of the original variables). These values are also stored in the <code>sdev</code> element of the result (<code>clim_acp$sdev</code>). The next two rows indicate first the ratio between the variance of a component and the total variance (sum of the variances of the 9 variables), then the cumulative proportion.</p>
<p>The variances associated with each principal component can be visualized with the <code>screeplot</code> function.</p>
<pre class="r"><code>screeplot(clim_acp)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The transformation between the original (standardized) variables and the principal components is given by the <code>rotation</code> element.</p>
<pre class="r"><code>round(clim_acp$rotation, 2)</code></pre>
<pre><code>##          PC1   PC2   PC3   PC4   PC5   PC6   PC7   PC8   PC9
## t_mean  0.47 -0.11  0.11 -0.27  0.19 -0.01  0.08  0.80  0.03
## t_diu  -0.09 -0.46  0.05 -0.35 -0.78  0.06 -0.06  0.07 -0.19
## t_sd   -0.38 -0.16 -0.58 -0.08  0.30  0.00 -0.01  0.20 -0.60
## t_max   0.27 -0.37 -0.33 -0.51  0.30  0.21 -0.06 -0.41  0.34
## t_min   0.46  0.07  0.36 -0.12  0.13  0.03 -0.18 -0.34 -0.69
## p_ann   0.33  0.37 -0.39 -0.01 -0.29  0.24  0.66 -0.08 -0.11
## p_max   0.39  0.15 -0.48  0.30 -0.25  0.00 -0.66  0.08  0.06
## p_min  -0.09  0.49 -0.09 -0.57 -0.08 -0.63 -0.10 -0.04  0.04
## p_cv    0.27 -0.45 -0.13  0.33  0.00 -0.71  0.29 -0.14 -0.02</code></pre>
<p>For example, the first column of this matrix tells us that the first principal component is calculated by the equation:</p>
<p><span class="math display">\[ PC1 = 0.47 T_{mean} - 0.09 T_{diu} - 0.38 T_{sd} + 0.27 T_{max} + 0.46 T_{min} + 
0.33 P_{ann} + 0.39 P_{max} - 0.09 P_{min} + 0.27 P_{cv} \]</span></p>
<p>Since the variables have been standardized beforehand, the magnitude of these coefficients indicates the importance of the association between a variable and the given principal component, while the sign indicates the direction of this association. In this case:</p>
<ul>
<li><p>the first principal component is associated with high values of the mean temperature and the minimum temperature;</p></li>
<li><p>the second component is primarily associated with a high minimum precipitation, a low diurnal variation of temperature and a small variation in precipitation.</p></li>
</ul>
<p>Conversely, the rows of the rotation matrix indicate how a unit increase of each original variable is “decomposed” on the different axes of the principal components.</p>
<p>The <code>x</code> element of the result gives the coordinates of each observation on the axes of the principal components:</p>
<pre class="r"><code>round(head(clim_acp$x), 2)</code></pre>
<pre><code>##            PC1   PC2   PC3   PC4   PC5   PC6   PC7   PC8   PC9
## Tokyo    -0.83  1.14 -1.07 -0.37  0.48  0.15  0.29 -0.03  0.01
## Shanghai -1.00  0.71 -1.00 -0.30  0.99  0.05  0.04  0.03 -0.01
## Mumbai    4.39  0.53 -2.00  1.97 -0.49 -0.24 -0.58  0.04  0.00
## Karachi   0.80 -2.03  0.81  0.09  1.04 -0.78  0.14  0.20  0.08
## Delhi     1.22 -2.75 -1.11 -0.58  0.05 -0.48 -0.12  0.01  0.06
## Manila    3.30  0.64 -0.51  0.48 -0.02  0.52  0.17 -0.08 -0.06</code></pre>
</div>
<div id="visualization-of-pca-results" class="section level2">
<h2>Visualization of PCA results</h2>
<p>In the previous section, we saw that each observation is associated with coordinates on the 9 principal component axes. We have also seen that a unit increase of one of the original variables is associated with a variation on each axis.</p>
<p>The biplot simultaneously displays the coordinates of the observations and the vectors corresponding to the original variables in the space of the principal components. This graph usually shows the first two components, which account for most of the total variance.</p>
<pre class="r"><code>biplot(clim_acp)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-12-1.png" width="576" /></p>
<p>The biplot can help us interpret the principal components. For example:</p>
<ul>
<li>The cities with the coldest climate (e.g. St. Petersburg, Montreal) are concentrated on the left of the graph, a little above the median, in the direction opposite to vectors associated with a higher minimum, mean and maximum temperature .</li>
<li><p>The cities on the right (e.g. Mumbai, Manila) are characterized by high temperatures all year (high <code>t_min</code>) and a high precipitation in the wettest month (<code>p_max</code>).</p></li>
<li><p>The city of Singapore is set apart from the others, in particular because of large amount of rain all year round (high <code>p_ann</code> and<code>p_min</code>).</p></li>
<li><p>The cities at the bottom of the graph have a high maximum temperature, at least one very dry season (low <code>p_min</code>) and a large daily temperature variation.</p></li>
</ul>
<p>Since the first two components account for only 70% of the total variance, it is to be expected that they do not fully represent the climatic “distance” between cities. For example, the city with the lowest annual rainfall (Lima) is at the center of the graph rather than near other arid climates; this is due to the fact that temperature variations are less pronounced in this city.</p>
<p>The <code>choices</code> argument of <code>biplot</code> allows us to visualize other components than the first two.</p>
<pre class="r"><code>biplot(clim_acp, choices = c(1, 3))</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-14-1.png" width="576" /></p>
<p>To interpret the third principal component, we can focus on the two cities at the extremes: Seoul and Lima were both near the center of the graph of components 1 and 2. In that graph, the temperature seasonality (<code>t_sd</code>) and the amount of precipitation (<code>p_ann</code> and <code>p_max</code>) pointed in opposite directions, because generally, the temperature varies less in cities with more precipitation. On the third principal component, these two variables are both associated with negative values, so this component makes it possible to contrast the cities with heavy precipitation and a large temperature variation (Seoul) from cities with low precipitation and a small temperature variation (Lima).</p>
</div>
<div id="how-many-principal-components" class="section level2">
<h2>How many principal components?</h2>
<p>Various criteria have been proposed to determine how many principal components are sufficient to describe muiltivariate data. In other words, which major components count for a sufficiently large portion of the total variance?</p>
<p>Here are the variances (square of the standard deviations) associated with the principal components in our example:</p>
<pre class="r"><code>clim_acp$sdev^2</code></pre>
<pre><code>## [1] 3.914417064 2.477765395 0.955214474 0.823859308 0.562545790 0.217664459
## [7] 0.040010038 0.006626862 0.001896610</code></pre>
<p>For standardized data, the sum of the variances is always equal to the number of variables (here, 9) and the mean of the variances is therefore 1. One of the simplest criteria therefore proposes to keep the components with a variance greater than 1. However, if all the variances are close to 1, this would mean that the original variables are almost independent, so that the PCA is not very useful.</p>
<p>Other criteria are based on more precise statistical tests, such as those evaluated in the article by Peres-Neto et al. (2005)</p>
<p>In practice, formal hypothesis tests are rarely necessary. For an exploratory data analysis, we always visualize the first two components, then we can inspect the following ones if they contribute to a non-negligible portion of the variance and are easily interpretable. For the use of principal components in a regression (see below), model selection methods can guide us on the number of principal components to be retained in the regression itself.</p>
</div>
<div id="pca-and-regression" class="section level2">
<h2>PCA and regression</h2>
<p>As mentioned above, it is difficult to estimate the parameters of a regression if the potential predictors are numerous and correlated. By transforming these predictors into a smaller number of uncorrelated variables, PCA can solve both of these problems.</p>
<p>The main disadvantage of this approach (PCA followed by a regression based on the principal components) is that the effects are generally more difficult to interpret according to the original variables, especially if several variables contribute substantially to each axis.</p>
<p>In some studies, the primary goal is to predict the response and there is little interest in the effect of individual predictors. For example, consider a project to identify dominant forest species from hyperspectral remote sensing imagery containing reflectance data for hundreds of wavelengths. In this case, multivariate methods such as PCA are used to reduce this reflectance spectrum to a smaller number of orthogonal components.</p>
</div>
</div>
<div id="agglomerative-hierarchical-clustering" class="section level1">
<h1>Agglomerative hierarchical clustering</h1>
<p>Agglomerative hierarchical clustering aims to create groups of similar observations according to a series of variables. The name comes from the fact that we start with the individual observations, which are progressively joined into groups until we obtain a single group. The resulting structure is a tree or <em>dendrogram</em> showing proximity relationships among all observations.</p>
<div id="distance-matrix" class="section level2">
<h2>Distance matrix</h2>
<p>The hierarchical clustering algorithm requires a matrix of the distance <span class="math inline">\(d_{ij}\)</span> for each pair of observations <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[  
\begin{bmatrix}
0 \\
d_{21} &amp; 0  \\
d_{31} &amp; d_{32} &amp; 0 \\
... \\
d_{n1} &amp; d_{n2} &amp; ... &amp; d_{n(n-1)} &amp; 0
\end{bmatrix}
\]</span></p>
<p>It is a <span class="math inline">\(n \times n\)</span> matrix where all diagonal values are zero (each observation is at a distance 0 of itself). Since the matrix is symmetric (<span class="math inline">\(d_{ji} = d_{ij}\)</span>), we can omit the values of the upper triangle in the representation.</p>
<p>For numerical variables, the most commonly used distance is the <em>Euclidean distance</em>, calculated as:</p>
<p><span class="math display">\[ d_{ij} = \sqrt{\sum_{k = 1}^p (x_{ik} - x_{jk})^2} \]</span></p>
<p>In two dimensions and replacing <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> with <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, this equation simplifies to:</p>
<p><span class="math display">\[  d_{ij} = \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2} \]</span></p>
<p>This is the distance in a straight line between the two points calculated from the Pythagorean theorem. The function above is therefore the generalization of this distance to <span class="math inline">\(p\)</span> dimensions.</p>
<p>In R, the <code>dist</code> function calculates the distance matrix between the rows of a numeric data matrix. This function uses the Euclidean distance by default.</p>
<p>As in the case of PCA, it is recommended to standardize the variables before calculating the distance matrix, in order to place them on a comparable scale.</p>
</div>
<div id="agglomerative-hierarchical-clustering-algorithm" class="section level2">
<h2>Agglomerative hierarchical clustering algorithm</h2>
<p>Suppose we have the following distance matrix between 4 observations.</p>
<p><span class="math display">\[
\begin{array}
&amp;&amp; A &amp; B &amp; C \\
B &amp; 11 \\
C &amp; 13 &amp; 6 \\ 
D &amp; 7 &amp; 11 &amp; 9 
\end{array}
\]</span></p>
<ol style="list-style-type: decimal">
<li><p>The algorithm first joins the two nearest observations, B and C (distance of 6) into a group.</p></li>
<li><p>Next, replace B and C with a single observation BC and calculate the distance between this group and each of the other existing observations.</p></li>
</ol>
<p>How is the distance of the new group determined from the previous distances? Different rules are possible. For now, let’s use a rule where the distance from a new group to an existing observation is the mean of the distances between each group member and the observation.</p>
<p><span class="math display">\[
\begin{array}
&amp; &amp; A &amp; BC \\
BC &amp; 12 &amp; \\
D &amp; 7 &amp; 10 
\end{array}
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>From that moment, the new group (BC) is treated as if it were an individual observation. Then just repeat steps 1 and 2 until there are only two groups, which are joined in the last step.</li>
</ol>
<p>In the example, the next step would be to group A and D (distance of 7). Finally, AD and BC are joined at a distance of 11 (mean of 10 and 12).</p>
</div>
<div id="hierarchical-clustering-with-r" class="section level2">
<h2>Hierarchical clustering with R</h2>
<p>The <code>hclust</code> function is used to perform agglomerative hierarchical clustering. Here is how we can apply it to the table of 9 climatic variables for 49 major cities. First, we compute the distance matrix, then perform clustering with the “average” method (the different methods will be presented later).</p>
<pre class="r"><code>clim_dist &lt;- dist(clim_norm)
clim_ch &lt;- hclust(clim_dist, method = &quot;average&quot;)
plot(clim_ch)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The “leaves” at the bottom of the dendrogram correspond to the individual observations. A horizontal line represents the grouping of two existing observations or groups. The scale to the left of the dendrogram (<code>Height</code>) indicates the distance corresponding to each grouping. As the distance increases, the number of groups decreases and the size of the groups increases.</p>
<p>The <code>method</code> argument indicates how to calculate the distance between groups:</p>
<ul>
<li><p>single linkage (<code>method = &quot;single&quot;</code>): the distance between two groups A and B corresponds to the minimal distance between an observation in A and an observation in B.</p></li>
<li><p>complete linkage (<code>method = &quot;complete&quot;</code>): the distance between A and B corresponds to the maximum distance between an observation in A and an observation in B.</p></li>
<li><p>average linkage (<code>method = &quot;average&quot;</code>): the distance between A and B corresponds to the mean of the distances over all pairs of observations where one is in A and other one in B (this is the method shown in the previous example).</p></li>
<li><p>Ward’s method (<code>method = &quot;ward.D2&quot;</code>) consists of choosing the grouping which minimizes the increase of the total intra-group variance.</p></li>
</ul>
<p>Let’s first contrast the results of single and complete linkage:</p>
<pre class="r"><code>clim_ch_min &lt;- hclust(clim_dist, method = &quot;single&quot;)
plot(clim_ch_min)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>clim_ch_max &lt;- hclust(clim_dist, method = &quot;complete&quot;)
plot(clim_ch_max)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<p>For the single linkage criterion, the more observations a group contains, the closer it potentially gets to other groups and individual observations, since the distance is based on the nearest observation among all those in the group. This is why this method tends to create large groups to which observations join one at a time. The opposite situation occurs for complete linkage: the larger the group, the more it can move away from other groups and observations. This is why this method tends to create small groups first before growing larger groups. Average linkage is a compromise between these two extremes.</p>
<p>Ward’s method is different since it involves minimizing the overall variance between observations of the same group. However, since the addition of a single observation far from the others may have a large effect on the variance, this method just like complete linkage tends to favor the smaller groups initially. These two methods make it possible to create more compact and balanced groups.</p>
<pre class="r"><code>clim_ch_ward &lt;- hclust(clim_dist, method = &quot;ward.D2&quot;)
plot(clim_ch_ward)</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="extract-groups-from-hierarchical-clustering-results" class="section level2">
<h2>Extract groups from hierarchical clustering results</h2>
<p>The hierarchical clustering defines a different number of groups along the dendrogram. The <code>cutree</code> function allows us to “cut” the dendrogram (1) to a certain height by specifying the <em>h</em> argument or (2) to get a specific number of groups by specifying the <em>k</em> argument. This function returns a vector indicating the index of the group corresponding to each observation, in the same order as the data matrix.</p>
<p>So let’s use this method to extract the three large groups from the last dendrogram (Ward’s method):</p>
<pre class="r"><code>groupes &lt;- cutree(clim_ch_ward, k = 3)
head(groupes)</code></pre>
<pre><code>##    Tokyo Shanghai   Mumbai  Karachi    Delhi   Manila 
##        1        1        2        3        3        2</code></pre>
</div>
<div id="compare-groups-to-ordination-results" class="section level2">
<h2>Compare groups to ordination results</h2>
<p>We will finally represent the groups obtained by hierarchical clustering on the graph of the first two PCA axes. First, we create a new data frame by attaching the first two principal components and the group index vector, which must be specified as a factor.</p>
<pre class="r"><code>ord_groupes &lt;- data.frame(clim_acp$x[, 1:2], groupe_ward = as.factor(groupes))
head(ord_groupes)</code></pre>
<pre><code>##                 PC1        PC2 groupe_ward
## Tokyo    -0.8292567  1.1390831           1
## Shanghai -0.9964678  0.7094018           1
## Mumbai    4.3904533  0.5328498           2
## Karachi   0.8027417 -2.0305728           3
## Delhi     1.2169313 -2.7525580           3
## Manila    3.2953893  0.6395510           2</code></pre>
<pre class="r"><code>ggplot(ord_groupes, aes(x = PC1, y = PC2, color = groupe_ward)) +
    geom_point() +
    geom_text(aes(label = rownames(ord_groupes)))</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Let’s now compare with four groups extracted from the complete linkage dendrogram:</p>
<pre class="r"><code>ord_groupes$groupe_max &lt;- as.factor(cutree(clim_ch_max, k = 4))

ggplot(ord_groupes, aes(x = PC1, y = PC2, color = groupe_max)) +
    geom_point() +
    geom_text(aes(label = rownames(ord_groupes)))</code></pre>
<p><img src="13E-Multivariate_analysis_Part1_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Besides the decision to place Singapore in a separate group or not, the differences between the two methods are found mostly in areas where groups overlap. From the graph, it is quite clear that the distribution of cities along the climatic axes is gradual rather than forming a few well-separated groups. In this case, ordination is a better way to condense information on the differences between the climates of different cities.</p>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<ul>
<li><p>Multivariate analyzes are used to describe and explain the joint distribution of several variables.</p></li>
<li><p>When variables represent different units, it is important to standardize them to obtain comparable scales for multivariate analysis.</p></li>
<li><p>Ordination aims to produce in a reduced number of dimensions (often 2) the most faithful representation possible of the variation between the multivariate observations.</p></li>
<li><p>Principal component analysis (PCA) is an ordination method that performs a linear transformation (rotation) of the original variables, in order to obtain principal components that are uncorrelated and ranked in descending order of variance. The coordinates of the observations and the original variables can be represented simultaneously in the principal component space with a biplot.</p></li>
<li><p>Clustering methods serve to classify multivariate observations in a small number of groups of observations that are as similar as possible. Agglomerative hierarchical clustering performs gradual grouping starting from the individual observations and according to different rules that define the distance between groups. This clustering method produces a dendrogram.</p></li>
</ul>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><strong>Textbooks</strong></p>
<ul>
<li><p>Manly, B.F. and Alberto, J.A.N. (2016) <em>Multivariate statistical methods: a primer</em>. Chapman and Hall/CRC.</p></li>
<li><p>Legendre, P. and Legendre, L. (2012) <em>Numerical Ecology</em>, 3e éd. Elsevier.</p></li>
<li><p>Borcard, D., Gillet, F. and Legendre, P. (2018) <em>Numerical Ecology with R</em>, 2e éd. Springer.</p></li>
</ul>
<p>Criteria to pick the number of principal components:</p>
<ul>
<li>Peres-Neto, P.R., Jackson, D.A. and Somers, K.M. (2005) “How many principal components? stopping rules for determining the number of non-trivial axes revisited.” <em>Computational Statistics and Data Analysis</em> 49: 974-997.</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
