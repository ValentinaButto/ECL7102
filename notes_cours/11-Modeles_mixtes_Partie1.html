<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Modèles linéaires mixtes, partie 1</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Modèles linéaires mixtes, partie 1</h1>
<h4 class="date"><br/>18 novembre 2019</h4>

</div>


<div id="objectifs" class="section level1">
<h1>Objectifs</h1>
<ul>
<li><p>Appliquer un modèle linéaire mixte à des données groupées.</p></li>
<li><p>Expliquer comment un modèle mixte constitue un compromis entre un modèle ignorant l’effet de groupe et un modèle à effets fixes par groupe.</p></li>
<li><p>Déterminer les situations où il est le plus bénéfique d’utiliser un modèle mixte.</p></li>
</ul>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<div id="exemple-croissance-de-plusieurs-especes-dans-une-foret" class="section level2">
<h2>Exemple: Croissance de plusieurs espèces dans une forêt</h2>
<p>Supposons que vous devez modéliser la croissance des arbres dans une forêt mixte. Vous avez mesuré les variables numériques suivantes sur un échantillon de 100 arbres de différentes espèces dans une parcelle de recherche:</p>
<ul>
<li>la croissance annuelle (variable réponse);</li>
<li>le diamètre (DHP) ;</li>
<li>l’âge;</li>
<li>l’indice de compétition (IC, basé sur le nombre et la taille des arbres voisins).</li>
</ul>
<p>Pour cet exercice, vous pouvez supposer que les variables ont été transformées pour assurer que l’effet de chaque prédicteur soit linéaire, et que la portion aléatoire de la réponse suit une distribution normale.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Quel type de modèle utiliseriez-vous pour représenter la relation entre la croissance annuelle et les trois prédicteurs?</p></li>
<li><p>Si la croissance moyenne dépend de l’espèce, comment inclure cet effet dans votre modèle?</p></li>
<li><p>Si l’effet des prédicteurs numériques sur la croissance dépend de l’espèce, comment inclure cet effet dans votre modèle?</p></li>
<li><p>Est-ce que les méthodes proposées en (b) et (c) fonctionnent mieux avec peu d’espèces (ex.: 100 arbres divisés en 2 espèces) ou beaucoup d’espèces (ex.: 100 arbres divisés en 20 espèces)? Est-ce qu’elles fonctionnent mieux si le nombre d’arbres échantillonné par espèce est semblable (ex.: 5 arbres pour chacune des 20 espèces) ou variable (ex.: de 2 à 30 arbres dépendant de l’espèce)?</p></li>
<li><p>Pouvez-vous utiliser ce modèle pour prédire la croissance d’une espèce qui n’est pas représentée dans votre échantillon de 100 arbres?</p></li>
</ol>
<p>Supposons maintenant que vous connaissez certaines caractéristiques de chaque espèce qui pourraient expliquer les différences entre espèces, par exemple:</p>
<ul>
<li>le degré de tolérance à l’ombre (variable catégorielle);</li>
<li>la surface foliaire spécifique (SFS, variable numérique).</li>
</ul>
<ol style="list-style-type: lower-alpha">
<li><p>Comment pouvez-vous inclure ces caractéristiques dans votre modèle?</p></li>
<li><p>Est-ce que le modèle proposé en (a) fonctionne mieux avec peu d’espèces ou beaucoup d’espèces?</p></li>
<li><p>Pouvez-vous utiliser ce modèle pour prédire la croissance d’une espèce qui n’est pas représentée dans votre échantillon de 100 arbres?</p></li>
</ol>
<p>Finalement, supposons que vous avez mesuré la croissance et les autres prédicteurs individuels sur les même 100 arbres pour trois années consécutives.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Comment pourriez-vous ajouter la variation de croissance d’une année à l’autre dans votre modèle? Serait-il utile d’ajouter des variables météorologiques du site (ex.: température moyenne) pour expliquer cette variation interannuelle?</p></li>
<li><p>Du point de vue statistique, est-ce que le fait de mesurer les mêmes arbres à chaque année influence l’exactitude des conclusions de la régression?</p></li>
</ol>
</div>
<div id="exemple-faune-benthique-aux-pays-bas" class="section level2">
<h2>Exemple: Faune benthique aux Pays-Bas</h2>
<p>Le jeu de données <a href="../donnees/rikz.csv">rikz.csv</a>, tiré du manuel de Zuur et al. (voir références en bas page), présente des données sur les communautés benthiques de 9 plages des Pays-Bas. La richesse spécifique (<code>Richness</code>) a été mesurée pour 5 sites sur chacune des 9 plages (<code>Beach</code>) pour un total de 45 observations. La variable <code>NAP</code> mesure la position verticale de chaque site par rapport au niveau moyen de la mer, tandis que l’indice d’exposition aux vagues (<code>Exposure</code>) est mesuré à l’échelle de la plage.</p>
<pre class="r"><code>rikz &lt;- read.csv(&quot;../donnees/rikz.csv&quot;)
# Corriger la représentation des variables catégorielles
rikz &lt;- mutate(rikz, Beach = as.factor(Beach), 
               Exposure = as.factor(Exposure))
head(rikz)</code></pre>
<pre><code>##   Sample Richness Exposure    NAP Beach
## 1      1       11       10  0.045     1
## 2      2       10       10 -1.036     1
## 3      3       13       10 -1.336     1
## 4      4       11       10  0.616     1
## 5      5       10       10 -0.684     1
## 6      6        8        8  1.190     2</code></pre>
<p>Puisque la réponse est un nombre d’espèces, une régression de Poisson pourrait être plus appropriée. Toutefois, les modèles linéaires mixtes généralisés ne font pas partie de ce cours. Nous appliquons donc une transformation racine carrée à la réponse afin d’utiliser la régression linéaire. Cette transformation améliore généralement l’homogénéité des variances pour les données de comptage.</p>
<pre class="r"><code>rikz &lt;- mutate(rikz, srich = sqrt(Richness))</code></pre>
<p>À partir de ces données, nous illustrerons différentes stratégies pour tenir compte de la nature groupée des données (9 plages) et du prédicteur défini au niveau du groupe (indice d’exposition).</p>
<div id="modele-1-ignorer-les-groupes" class="section level3">
<h3>Modèle 1: Ignorer les groupes</h3>
<p>Le premier modèle inclut seulement le prédicteur au niveau du site (NAP), avec un <span class="math inline">\(R^2\)</span> ajusté de 0.46. L’effet de ce prédicteur est significatif et indique que les sites plus élevés ont une richesse spécifique plus faible.</p>
<pre class="r"><code>mod1 &lt;- lm(srich ~ NAP, rikz)
summary(mod1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP, data = rikz)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.1898 -0.5874 -0.1233  0.2603  2.0089 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.3952     0.1241  19.295  &lt; 2e-16 ***
## NAP          -0.7409     0.1190  -6.224 1.72e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7851 on 43 degrees of freedom
## Multiple R-squared:  0.474,  Adjusted R-squared:  0.4617 
## F-statistic: 38.74 on 1 and 43 DF,  p-value: 1.724e-07</code></pre>
<p>Voici la droite représentant les prédictions du modèle en fonction du NAP.</p>
<pre class="r"><code>rikz$fit1 &lt;- fitted(mod1)

ggplot(rikz, aes(x = NAP, y = srich)) +
    geom_point() +
    geom_line(aes(y = fit1))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>La régression linéaire suppose que les résidus sont indépendants d’une observation à l’autre. Ce n’est pas le cas ici, puisque les 5 sites d’une même plage sont plus similaires par rapport aux sites de plages différentes.</p>
<pre class="r"><code>ggplot(rikz, aes(x = Beach, y = residuals(mod1))) +
    geom_point()</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="modele-2-estimation-des-coefficients-pour-chaque-groupe" class="section level3">
<h3>Modèle 2: Estimation des coefficients pour chaque groupe</h3>
<p>L’ajout du facteur <code>Beach</code> au modèle permet d’estimer les différences systématiques de richesse entre les plages.</p>
<pre class="r"><code>mod2 &lt;- lm(srich ~ NAP + Beach, rikz)
summary(mod2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP + Beach, data = rikz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.58544 -0.28653 -0.06544  0.23657  1.69043 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.99457    0.26711  11.211 3.92e-13 ***
## NAP         -0.66410    0.09655  -6.878 5.49e-08 ***
## Beach2       0.61544    0.37909   1.623  0.11346    
## Beach3      -1.21158    0.37491  -3.232  0.00268 ** 
## Beach4      -1.13596    0.38510  -2.950  0.00564 ** 
## Beach5      -0.32863    0.38648  -0.850  0.40093    
## Beach6      -0.90219    0.37835  -2.385  0.02265 *  
## Beach7      -0.98741    0.39419  -2.505  0.01705 *  
## Beach8      -0.89080    0.38392  -2.320  0.02628 *  
## Beach9      -0.79350    0.38561  -2.058  0.04712 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5882 on 35 degrees of freedom
## Multiple R-squared:  0.7596, Adjusted R-squared:  0.6978 
## F-statistic: 12.29 on 9 and 35 DF,  p-value: 1.744e-08</code></pre>
<p>Ce modèle revient à estimer une ordonnée à l’origine différente pour chaque groupe: le coefficient <code>Intercept</code> est la moyenne de <code>srich</code> pour la première plage lorsque <code>NAP = 0</code> (au niveau moyen de la mer), la valeur de <code>Beach2</code> est la différence entre la moyenne des plages 2 et 1, etc.</p>
<p>Le <span class="math inline">\(R^2\)</span> ajusté a augmenté à 0.70 pour ce modèle. Voici le graphique des droites de prédiction.</p>
<pre class="r"><code>rikz$fit2 &lt;- fitted(mod2)

ggplot(rikz, aes(x = NAP, y = srich, color = Beach)) +
    geom_point() +
    geom_line(aes(y = fit2))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Un modèle plus flexible permettrait à l’effet du NAP (la pente de la droite) de varier d’une plage à l’autre, en ajoutant l’interaction entre <code>NAP</code> et <code>Beach</code>.</p>
<pre class="r"><code>mod2_inter &lt;- lm(srich ~ NAP * Beach, rikz)
summary(mod2_inter)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP * Beach, data = rikz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.84831 -0.16080 -0.03091  0.14909  0.98737 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.28835    0.24259  13.555 1.45e-13 ***
## NAP         -0.05077    0.28172  -0.180 0.858319    
## Beach2       0.30239    0.32158   0.940 0.355394    
## Beach3      -1.50542    0.31542  -4.773 5.61e-05 ***
## Beach4      -1.56073    0.33715  -4.629 8.25e-05 ***
## Beach5       0.11078    0.35432   0.313 0.756947    
## Beach6      -1.25466    0.31812  -3.944 0.000513 ***
## Beach7      -1.39537    0.41116  -3.394 0.002144 ** 
## Beach8      -1.17907    0.32697  -3.606 0.001242 ** 
## Beach9      -0.85912    0.33879  -2.536 0.017314 *  
## NAP:Beach2  -0.54313    0.36261  -1.498 0.145780    
## NAP:Beach3  -0.47943    0.37104  -1.292 0.207267    
## NAP:Beach4  -0.37552    0.35511  -1.057 0.299666    
## NAP:Beach5  -1.82561    0.38805  -4.705 6.74e-05 ***
## NAP:Beach6  -0.36229    0.33258  -1.089 0.285636    
## NAP:Beach7  -0.48212    0.41379  -1.165 0.254155    
## NAP:Beach8  -0.62429    0.32975  -1.893 0.069089 .  
## NAP:Beach9  -1.01278    0.35527  -2.851 0.008256 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4508 on 27 degrees of freedom
## Multiple R-squared:  0.8911, Adjusted R-squared:  0.8225 
## F-statistic:    13 on 17 and 27 DF,  p-value: 7.079e-09</code></pre>
<p>Le <span class="math inline">\(R^2\)</span> ajusté a augmenté à 0.82, mais ce modèle compte 17 paramètres ajustables pour seulement 45 observations. D’après l’AICc, le modèle sans interaction constitue le meilleur compromis entre complexité et ajustement.</p>
<pre class="r"><code>library(AICcmodavg)
aictab(list(mod1 = mod1, mod2 = mod2, mod2_inter = mod2_inter))</code></pre>
<pre><code>## 
## Model selection based on AICc:
## 
##             K   AICc Delta_AICc AICcWt Cum.Wt     LL
## mod2       11  98.64       0.00    0.8    0.8 -34.32
## mod2_inter 19 101.41       2.77    0.2    1.0 -16.50
## mod1        3 110.47      11.82    0.0    1.0 -51.94</code></pre>
<p>Voici les droites de prédiction du modèle avec interaction. Ce modèle est presque équivalent à une régression linéaire effectuée indépendamment pour chaque groupe, excepté que la variance des résidus doit être la même pour tous les groupes. Chacune des droites est estimée à partir de seulement 5 observations, c’est pourquoi il est probable que le modèle exagère les différences entres plages (surajustement).</p>
<pre class="r"><code>rikz$fit2i &lt;- fitted(mod2_inter)

ggplot(rikz, aes(x = NAP, y = srich, color = Beach)) +
    geom_point() +
    geom_line(aes(y = fit2i))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="modele-3-predicteur-lie-aux-groupes" class="section level3">
<h3>Modèle 3: Prédicteur lié aux groupes</h3>
<p>Plutôt que d’estimer la richesse moyenne et/ou la relation entre richesse et le NAP de façon indépendante pour chaque plage (comme dans le modèle précédent), nous pourrions plutôt essayer d’expliquer ces différences en fonction de facteurs mesurés au niveau de la plage.</p>
<p>Le modèle suivant suppose que la richesse spécifique (transformée) est une fonction de l’interaction entre NAP (défini par site) et l’indice d’exposition défini par plage.</p>
<pre class="r"><code>mod3 &lt;- lm(srich ~ NAP * Exposure, rikz)
summary(mod3)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP * Exposure, data = rikz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.01561 -0.26022 -0.07632  0.18031  1.62592 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      3.5907     0.2641  13.597  &lt; 2e-16 ***
## NAP             -0.5939     0.2856  -2.079  0.04420 *  
## Exposure10      -1.0101     0.2950  -3.424  0.00146 ** 
## Exposure11      -1.7375     0.2976  -5.839 8.68e-07 ***
## NAP:Exposure10  -0.3680     0.3113  -1.182  0.24429    
## NAP:Exposure11   0.1281     0.3140   0.408  0.68549    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5639 on 39 degrees of freedom
## Multiple R-squared:  0.7538, Adjusted R-squared:  0.7223 
## F-statistic: 23.88 on 5 and 39 DF,  p-value: 6.417e-11</code></pre>
<p>Notez qu’il ne suffit pas de consulter les coefficients pour voir si l’interaction est significative, il faut plutôt se baser sur le tableau d’ANOVA.</p>
<pre class="r"><code>anova(mod3)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: srich
##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## NAP           1 23.8787 23.8787 75.0869 1.255e-10 ***
## Exposure      2 11.6166  5.8083 18.2643 2.527e-06 ***
## NAP:Exposure  2  2.4831  1.2416  3.9041   0.02848 *  
## Residuals    39 12.4026  0.3180                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Ici, l’interaction est significative même si les coefficients <code>NAP:Exposure10</code> et <code>NAP:Exposure11</code> du modèle ne le sont pas. Ces coefficients indiquent seulement la différence entre les pentes de <em>srich</em> vs. <em>NAP</em> pour les niveaux d’exposition 10 et 8 (dans le premier cas) ou 11 et 8 (dans le second cas). Il est possible que la différence la plus significative soit entre les niveaux 10 et 11, comme le suggèrent les droites de prédiction.</p>
<pre class="r"><code>rikz$fit3 &lt;- fitted(mod3)

ggplot(rikz, aes(x = NAP, y = srich, color = Exposure)) +
    geom_point() +
    geom_line(aes(y = fit3))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Par rapport au modèle précédent, cette approche est non seulement plus parcimonieuse (moins de paramètres à ajuster), mais elle nous permet aussi d’expliquer les différences entre plages en fonction de paramètres environnementaux. Nous pourrions donc appliquer les prédictions du modèle à d’autres plages en autant que nous connaissions leur indice d’exposition.</p>
<p>Dans le cas présent, il semble que l’indice d’exposition explique une bonne partie de la variation entre groupes. Toutefois, comment pourrions-nous inclure des différences qui subsistent entre les groupes après avoir contrôlé l’effet de cet indice?</p>
<p>Dans un contexte de régression linéaire classique, il n’est pas possible d’inclure à la fois une variable catégorielle indiquant le groupe et un prédicteur défini pour chaque groupe. Dans l’exemple suivant, puisque les différences de richesse moyenne entre plages (après avoir contrôlé l’effet du NAP) sont entièrement prises en compte par le facteur Beach, il ne reste plus rien à expliquer par la variable Exposure.</p>
<pre class="r"><code>mod_exp_beach &lt;- lm(srich ~ NAP + Beach + Exposure, rikz)
summary(mod_exp_beach)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP + Beach + Exposure, data = rikz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.58544 -0.28653 -0.06544  0.23657  1.69043 
## 
## Coefficients: (2 not defined because of singularities)
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.99457    0.26711  11.211 3.92e-13 ***
## NAP         -0.66410    0.09655  -6.878 5.49e-08 ***
## Beach2       0.61544    0.37909   1.623  0.11346    
## Beach3      -1.21158    0.37491  -3.232  0.00268 ** 
## Beach4      -1.13596    0.38510  -2.950  0.00564 ** 
## Beach5      -0.32863    0.38648  -0.850  0.40093    
## Beach6      -0.90219    0.37835  -2.385  0.02265 *  
## Beach7      -0.98741    0.39419  -2.505  0.01705 *  
## Beach8      -0.89080    0.38392  -2.320  0.02628 *  
## Beach9      -0.79350    0.38561  -2.058  0.04712 *  
## Exposure10        NA         NA      NA       NA    
## Exposure11        NA         NA      NA       NA    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5882 on 35 degrees of freedom
## Multiple R-squared:  0.7596, Adjusted R-squared:  0.6978 
## F-statistic: 12.29 on 9 and 35 DF,  p-value: 1.744e-08</code></pre>
<p>Ainsi, nous obtenons des valeurs <code>NA</code> pour les coefficients liés à l’indice exposition. Remarquez que la sortie de ce modèle est identique à celle de <code>mod2</code>. Si on avait écrit la formule avec Exposure avant Beach, le modèle estimerait les effets des deux coefficients de l’indice d’exposition, mais en contrepartie, deux des effets de plage deviendraient <code>NA</code>. Au niveau des prédictions, il s’agirait du même modèle.</p>
<p>Un problème identique survient si on essayait de modéliser une variation de la pente de <code>srich ~ NAP</code> en fonction de l’indice d’exposition et de la plage. Ce modèle serait équivalent à <code>mod2_inter</code> plus haut.</p>
<pre class="r"><code>mod_exp_beach &lt;- lm(srich ~ NAP * Exposure + NAP * Beach , rikz)
all.equal(fitted(mod_exp_beach), fitted(mod2_inter)) </code></pre>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="modele-4-modele-lineaire-en-deux-etapes" class="section level3">
<h3>Modèle 4: Modèle linéaire en deux étapes</h3>
<p>Pour résoudre le problème évoqué à la fin de la section précédente, nous pourrions d’abord estimer les différences de richesse entre plages à partir des données des sites, puis ensuite modéliser l’effet des plages en fonction de l’indice d’exposition.</p>
<p>Pour la première étape, nous utilisons le modèle 2 ci-dessus (ordonnée à l’origine qui varie par plage), sauf que nous ajoutons <code>- 1</code> à la formule du modèle pour signifier que l’ordonnée à l’origine est zéro. Ce truc nous permet d’obtenir des coefficients pour chaque plage qui correspondent à l’ordonnée à l’origine de cette plage, plutôt qu’à une différence mesurée à partir d’un niveau de référence. Notez que ce truc fonctionne seulement pour la première variable catégorielle dans une régression.</p>
<pre class="r"><code>mod4_1 &lt;- lm(srich ~ NAP + Beach - 1, rikz)
summary(mod4_1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = srich ~ NAP + Beach - 1, data = rikz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.58544 -0.28653 -0.06544  0.23657  1.69043 
## 
## Coefficients:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## NAP    -0.66410    0.09655  -6.878 5.49e-08 ***
## Beach1  2.99457    0.26711  11.211 3.92e-13 ***
## Beach2  3.61000    0.26440  13.653 1.39e-15 ***
## Beach3  1.78298    0.26307   6.778 7.41e-08 ***
## Beach4  1.85861    0.26839   6.925 4.78e-08 ***
## Beach5  2.66594    0.26948   9.893 1.12e-11 ***
## Beach6  2.09238    0.26404   7.924 2.55e-09 ***
## Beach7  2.00715    0.27616   7.268 1.73e-08 ***
## Beach8  2.10377    0.26751   7.864 3.04e-09 ***
## Beach9  2.20106    0.26879   8.189 1.20e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5882 on 35 degrees of freedom
## Multiple R-squared:  0.9527, Adjusted R-squared:  0.9392 
## F-statistic: 70.48 on 10 and 35 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Créons ensuite un deuxième jeu de données contenant seulement les plages et leur indice d’exposition. Nous utiliserons pour cela la fonction <code>distinct</code> de <em>dplyr</em>, qui extrait les combinaisons uniques des variables spécifiées dans un tableau de données.</p>
<pre class="r"><code>rikz_beach &lt;- distinct(rikz, Beach, Exposure)
rikz_beach</code></pre>
<pre><code>##   Beach Exposure
## 1     1       10
## 2     2        8
## 3     3       11
## 4     4       11
## 5     5       10
## 6     6       11
## 7     7       11
## 8     8       10
## 9     9       10</code></pre>
<p>Nous ajoutons ensuite à ce tableau les coefficients de l’étape 1 qui constituent la réponse à modéliser au niveau de la plage.</p>
<pre class="r"><code>rikz_beach$coef &lt;- coef(mod4_1)[-1] # Le coefficient 1 est NAP

mod4_2 &lt;- lm(coef ~ Exposure, rikz_beach)
summary(mod4_2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = coef ~ Exposure, data = rikz_beach)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.3876 -0.1523  0.0000  0.1571  0.5032 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.6100     0.3101  11.640 2.42e-05 ***
## Exposure10   -1.1187     0.3467  -3.226  0.01800 *  
## Exposure11   -1.6747     0.3467  -4.830  0.00291 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3101 on 6 degrees of freedom
## Multiple R-squared:  0.803,  Adjusted R-squared:  0.7373 
## F-statistic: 12.23 on 2 and 6 DF,  p-value: 0.007645</code></pre>
<p>Un des problèmes de cette approche est que chaque plage est considérée comme un seul point à la deuxième étape. Si le nombre d’échantillons différait d’une plage à l’autre, ce modèle sous-représenterait les plages mieux échantillonnés. Pour ce cas-ci, chaque plage a le même nombre de points et les coefficients estimés pour l’indice d’exposition sont très près de ceux obtenus par le modèle 3.</p>
</div>
</div>
</div>
<div id="modeles-lineaires-mixtes" class="section level1">
<h1>Modèles linéaires mixtes</h1>
<p>Les <strong>modèles mixtes</strong> sont conceptuellement semblables à la régression en deux étapes effectuée ci-dessus, sauf que les deux étapes sont réalisées simultanément afin de tenir compte de l’incertitude des coefficients de groupe. Ce type de modèle est particulièrement utile lorsqu’une ou plusieurs des conditions suivantes s’appliquent:</p>
<ul>
<li><p>les données sont groupées ou ont une structure hiérarchique à deux ou plusieurs niveaux (ex.: placettes regroupées par sites regroupés par région);</p></li>
<li><p>les variables explicatives sont aussi définies à plusieurs niveaux;</p></li>
<li><p>le nombre de groupes est trop grand, ou le nombre d’observations dans certains groupes est trop petit, pour estimer un effet séparé pour chaque groupe;</p></li>
<li><p>on s’intéresse davantage à la variation entre les groupes qu’à l’effet de groupes particuliers;</p></li>
<li><p>on souhaite appliquer le modèle à des groupes où aucune mesure n’a été prise.</p></li>
</ul>
<div id="representation-mathematique-dun-modele-lineaire-mixte" class="section level2">
<h2>Représentation mathématique d’un modèle linéaire mixte</h2>
<p>Un <strong>modèle linéaire mixte</strong> est une régression linéaire dont un ou plusieurs des coefficients varient d’un groupe d’observations à une autre, <em>et où cette variation est modélisée par une distribution statistique</em>. Ils sont aussi connus sous le nom de modèles <em>hiérarchiques</em> ou <em>multi-niveaux</em>, car ils modélisent la variation à au moins deux niveaux (observation individuelle et groupe).</p>
<p>Nous commencerons par traiter des modèles mixtes où seule l’ordonnée à l’origine varie par groupe. Pour ce type de modèle, la valeur moyenne de la réponse de l’observation <span class="math inline">\(k\)</span> (<span class="math inline">\(\hat{y_k}\)</span>) correspond à la combinaison linéaire des prédicteurs <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, etc. à laquelle s’ajoute une ordonnée à l’origine spécifique au groupe <span class="math inline">\(j\)</span> qui contient l’observation <span class="math inline">\(k\)</span>: <span class="math inline">\(\alpha_{j[k]}\)</span>. (Nous utilisons <span class="math inline">\(\alpha\)</span> plutôt que <span class="math inline">\(\beta_0\)</span> pour l’ordonnée à l’origine afin de simplifier un peu la notation.)</p>
<p><span class="math display">\[ \hat{y_k} = \alpha_{j[k]} + \beta_1 x_{1k} + \beta_2 x_{2k} + ...\]</span></p>
<p>Comme pour le modèle de régression linéaire, l’observation <span class="math inline">\(y_k\)</span> suit une distribution normale autour de sa moyenne. Le suffixe <span class="math inline">\(y\)</span> a été ajouté à <span class="math inline">\(\sigma\)</span> pour spécifier qu’il s’agit de l’écart-type des observations <span class="math inline">\(y\)</span>.</p>
<p><span class="math display">\[ y_k \sim N(\hat{y_k}, \sigma_y) \]</span></p>
<p>Jusqu’à maintenant, ce modèle est identique à celui d’une régression linéaire avec une variable catégorielle, si <span class="math inline">\(\alpha_j\)</span> était l’ordonnée à l’origine pour la catégorie <span class="math inline">\(j\)</span>. La particularité du modèle mixte est que les <span class="math inline">\(\alpha_j\)</span> sont des valeurs aléatoires tirées d’une distribution normale avec une moyenne <span class="math inline">\(\mu_\alpha\)</span> et un écart-type <span class="math inline">\(\sigma_\alpha\)</span>. Autrement dit, les groupes observés font partie d’une “population” de groupes possibles et nous souhaitons estimer la moyenne et la variance de <span class="math inline">\(\alpha\)</span> dans cette population.</p>
<p><span class="math display">\[ \alpha_{j} \sim N(\mu_\alpha, \sigma_\alpha) \]</span></p>
<p>L’effet de groupe <span class="math inline">\(\alpha_j\)</span> est désigné comme un effet <em>aléatoire</em>, en opposition aux effets <em>fixes</em> qui sont estimés de façon indépendante sans faire partie d’une distribution commune (par exemple, les <span class="math inline">\(m - 1\)</span> coefficients d’un facteur à <span class="math inline">\(m\)</span> catégories dans une régression linéaire classique). Ce modèle est appelé <em>mixte</em> car il contient à la fois des effets fixes (les <span class="math inline">\(\beta\)</span> associés aux prédicteurs <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, etc.) et des effets aléatoires.</p>
<p>Il n’y a pas de raison particulière d’avoir choisi une distribution normale pour les <span class="math inline">\(\alpha_j\)</span>. Cependant, si tout ce qu’on sait d’une variable est sa moyenne et son écart-type, la distribution normale est dans un certain sens la plus probable, c’est-à-dire celle qui amène le moins de suppositions supplémentaires.</p>
</div>
<div id="modele-lineaire-mixte-avec-r" class="section level2">
<h2>Modèle linéaire mixte avec R</h2>
<p>Dans cet exemple, nous ajusterons un modèle mixte du type présenté ci-dessus aux mêmes données du tableau <code>rikz</code>. Le modèle inclut le prédicteur <code>NAP</code> et une ordonnée à l’origine qui varie selon la plage.</p>
<p>Pour estimer les paramètres d’un modèle mixte, nous utilisons la fonction <code>lmer</code> du package <em>lme4</em>. La formule d’un modèle mixte ressemble à celles déjà vues, sauf pour le dernier terme: <code>(1 | Beach)</code>. Ce terme signifie que l’ordonnée à l’origine (désignée par <code>1</code>) varie entre les niveaux de la variable <code>Beach</code>.</p>
<pre class="r"><code>library(lme4)

mmod &lt;- lmer(srich ~ NAP + (1 | Beach), rikz)
summary(mmod)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: srich ~ NAP + (1 | Beach)
##    Data: rikz
## 
## REML criterion at convergence: 97.1
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.5693 -0.4286 -0.1869  0.3230  2.9399 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Beach    (Intercept) 0.2957   0.5438  
##  Residual             0.3460   0.5882  
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  2.37424    0.20405  11.635
## NAP         -0.68063    0.09501  -7.163
## 
## Correlation of Fixed Effects:
##     (Intr)
## NAP -0.162</code></pre>
<p>Regardons les différentes composantes de ce résultat. La première ligne indique que le modèle a été ajusté avec la méthode du maximum de vraisemblance restreint (REML, pour <em>restricted maximum likelihood</em>). Sans entrer trop dans les détails, le REML sert à corriger le biais du maximum de vraisemblance lorsque vient le temps d’estimer des variances (effets aléatoires).</p>
<p>Le bloc d’effets aléatoires (<code>Random effects</code>) contient les estimés pour la variance et l’écart-type de l’ordonnée à l’origine (<span class="math inline">\(\sigma_\alpha\)</span>), ainsi que la variance et l’écart-type résiduel (<span class="math inline">\(\sigma_y\)</span>). Le bloc d’effets fixes indique l’estimé pour la moyenne de l’ordonnée à l’origine (<span class="math inline">\(\mu_\alpha\)</span>) et l’effet du NAP. Le sommaire indique aussi la corrélation estimée entre les deux effets fixes. Une corrélation négative est normale lorsque la valeur moyenne du prédicteur est supérieure à zéro: si on pivote la droite autour de la moyenne de façon à augmenter la pente, la position de l’ordonnée à l’origine descend le long de l’axe des <span class="math inline">\(y\)</span> (voir diagramme ci-dessous).</p>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-20-1.png" width="288" /></p>
<p>Remarquez que <code>lmer</code> ne fournit pas de valeur <span class="math inline">\(p\)</span> pour les effets estimés, car contrairement au cas d’un modèle linéaire, la distribution exacte de ces estimés n’est pas connue. Nous pouvons néanmoins obtenir des intervalle de confiance approximatifs avec <code>confint</code>.</p>
<pre class="r"><code>confint(mmod)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                  2.5 %     97.5 %
## .sig01       0.2664346  0.9469885
## .sigma       0.4682062  0.7455375
## (Intercept)  1.9537581  2.7916024
## NAP         -0.8729868 -0.4948024</code></pre>
<p>L’effet du NAP est donc significatif avec un seuil de <span class="math inline">\(\alpha = 0.05\)</span>. Dans ce tableau <code>.sig01</code> correspond à <span class="math inline">\(\sigma_\alpha\)</span> et <code>.sigma</code> à <span class="math inline">\(\sigma_y\)</span>. Les écarts-types doivent être positifs. Une valeur inférieure ou égale à zéro pour un écart-type ou son intervalle de confiance indique que le modèle est mal spécifié.</p>
<p>Nous pouvons extraire séparément les effets fixes et aléatoires du modèle avec les fonctions <code>fixef</code> et <code>ranef</code>.</p>
<pre class="r"><code>fixef(mmod)</code></pre>
<pre><code>## (Intercept)         NAP 
##   2.3742423  -0.6806307</code></pre>
<pre class="r"><code>ranef(mmod)</code></pre>
<pre><code>## $Beach
##   (Intercept)
## 1   0.4962684
## 2   1.0050818
## 3  -0.4791252
## 4  -0.4104708
## 5   0.2444787
## 6  -0.2252788
## 7  -0.2858167
## 8  -0.2124511
## 9  -0.1326862</code></pre>
<p>Les effets aléatoires sont les estimés de la différence entre l’ordonnée à l’origine de chaque plage (1 à 9) et leur moyenne donnée par <code>(Intercept)</code>. L’ordonnée à l’origine estimée pour la plage 1 est donc 2.37 + 0.50 = 2.87 et ainsi de suite. Plutôt que ce calculer ces valeurs pour chaque plage, nous pouvons les obtenir avec la fonction <code>coef</code>.</p>
<pre class="r"><code>coef(mmod)</code></pre>
<pre><code>## $Beach
##   (Intercept)        NAP
## 1    2.870511 -0.6806307
## 2    3.379324 -0.6806307
## 3    1.895117 -0.6806307
## 4    1.963772 -0.6806307
## 5    2.618721 -0.6806307
## 6    2.148964 -0.6806307
## 7    2.088426 -0.6806307
## 8    2.161791 -0.6806307
## 9    2.241556 -0.6806307
## 
## attr(,&quot;class&quot;)
## [1] &quot;coef.mer&quot;</code></pre>
<p>Le résultat de cette fonction nous donne les coefficients de la régression linéaire par groupe. Notre modèle n’inclut pas d’effets aléatoires sur le coefficient de <code>NAP</code>, donc celui-ci est constant pour tous les groupes.</p>
<p>Quelle est la différence entre ces effets estimés pour chaque plage et ceux d’un modèle linéaire classique où la variable catégorielle <code>Beach</code> était spécifiée comme effet fixe? Comparons les droites de prédiction du modèle mixte (lignes pleines) avec celles du modèle 2 vu plus haut (<code>lm(srich ~ NAP + Beach)</code>, lignes pointillées). Nous ajoutons aussi la droite correspondant au modèle 1 qui ignore les différences entre plages (traits noirs).</p>
<pre class="r"><code>rikz$fitmm &lt;- fitted(mmod)

ggplot(rikz, aes(x = NAP, y = srich, color = Beach)) +
    geom_point() + 
    geom_line(aes(y = fit1), color = &quot;black&quot;, linetype = &quot;dashed&quot;) +
    geom_line(aes(y = fit2), linetype = &quot;dotted&quot;) +
    geom_line(aes(y = fitmm))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Les prédictions du modèle mixte pour chaque plage sont décalées vers la moyenne générale. Cet effet est plus prononcé à mesure qu’on s’éloigne de la moyenne (voir par exemple la plage 2 en haut du graphique). En statistique, on parle d’une contraction (<em>shrinkage</em>) des estimés des effets de groupe.</p>
</div>
<div id="modele-mixte-comme-compromis-entre-sous-ajustement-et-surajustement" class="section level2">
<h2>Modèle mixte comme compromis entre sous-ajustement et surajustement</h2>
<p>Que se passe-t-il ici? En supposant que les effets de chaque plage proviennent d’une distribution commune, le modèle mixte estime l’ordonnée à l’origine de chaque plage en tenant compte non seulement des valeurs mesurées à cette plage, mais aussi de celles des autres plages. Il s’agit donc d’un compromis entre sous-ajustement (ex.: le modèle 1, qui ignore totalement les différences entre plages) et surajustement (ex.: le modèle 2, qui estime indépendamment les moyennes de chaque plage à partir des 5 points de cette plage).</p>
<p>Autrement dit, les différences entre les valeurs moyennes mesurées par plage peuvent être dues soit à des différences réelles de richesse spécifique entre les plages, soit au hasard de l’échantillonnage. L’ANOVA que nous avons vue plus tôt cette session visait à déterminer si ces différences entre groupes d’observations sont trop grandes pour être dues au hasard. Le modèle mixte tente plutôt d’estimer la portion des différences observées qui est due à un réel effet de groupe et la portion qui est due au hasard de l’échantillonnage dans chaque groupe.</p>
</div>
<div id="graphiques-de-diagnostic" class="section level2">
<h2>Graphiques de diagnostic</h2>
<p>La fonction <code>plot</code> appliquée à un modèle mixte ne produit qu’un graphique, celui des résidus en fonction des valeurs attendues.</p>
<pre class="r"><code>plot(mmod)</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Pour reproduire le diagramme quantile-quantile des résidus, nous pouvons appeler les fonctions <code>qqnorm</code> et <code>qqline</code>. Ce graphique montre que les résidus aux extrêmes sont plus grands que ceux prévus par la distribution normale.</p>
<pre class="r"><code>qqnorm(residuals(mmod))
qqline(residuals(mmod))</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Dans le modèle mixte, les effets de groupe sont aussi supposés suivre une distribution normale. Nous vérifions cette supposition en réalisant un diagramme quantile-quantile des effets aléatoires (<code>ranef</code>).</p>
<pre class="r"><code>beach_coef &lt;- ranef(mmod)$Beach
qqnorm(beach_coef$`(Intercept)`)
qqline(beach_coef$`(Intercept)`)</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Même avec seulement 9 points, il est évident que les différences au niveau de la plage ne sont pas normalement distribuées.</p>
<p>Notez que les mesures d’influence des observations comme la distance de Cook ne s’appliquent pas aux modèles mixtes.</p>
</div>
</div>
<div id="modele-mixte-avec-predicteur-lie-aux-groupes" class="section level1">
<h1>Modèle mixte avec prédicteur lié aux groupes</h1>
<p>À la fin de la section précédente, nous avons vu que les différences entre chaque plage et la moyenne des données ne suivent pas une distribution normale. Est-ce qu’une partie de ces différences pourrait être expliquée par l’indice d’exposition (<code>Exposure</code>) mesuré par plage?</p>
<p>Pour inclure l’effet d’un prédicteur mesuré au niveau du groupe, nous devons modifier le modèle de la section précédente. L’ordonnée à l’origine par groupe était définie par une distribution normale:</p>
<p><span class="math display">\[ \alpha_{j} \sim N(\mu_\alpha, \sigma_\alpha) \]</span></p>
<p>Dans ce cas-ci, <span class="math inline">\(\mu_\alpha\)</span> n’est plus une constante, mais varie de façon linéaire en fonction d’un prédicteur <span class="math inline">\(u_1\)</span>.</p>
<p><span class="math display">\[ \mu_\alpha = \gamma_0 + \gamma_1 u_1 \]</span></p>
<p>Il s’agit donc d’un modèle de régression à deux niveaux, où <span class="math inline">\(u_1\)</span> est un prédicteur au niveau du groupe et <span class="math inline">\(\gamma_1\)</span> est le coefficient de ce prédicteur. D’un point de vue conceptuel, il est utile de différencier les prédicteurs définis par groupe et ceux définis par observation individuelle. Toutefois, nous pourrions aussi ré-écrire le modèle pour séparer les effets fixes (aux deux niveaux) et les effets aléatoires (qui ont une moyenne de 0), par exemple:</p>
<p><span class="math display">\[ y_k = \gamma_0 + \gamma_1 u_{1j[k]} + \beta_1 x_{1k} + \beta_2 x_{2k} + \nu_{j[k]} + \epsilon_k \]</span></p>
<p>Dans cette représentation, la valeur <span class="math inline">\(y_k\)</span> pour l’observation <span class="math inline">\(k\)</span> dépend de l’ordonnée à l’origine <span class="math inline">\(\gamma_0\)</span>, d’un prédicteur de groupe <span class="math inline">\(u_1\)</span> et de deux prédicteurs individuels (<span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>). Les deux derniers termes représentent respectivement la variation aléatoire du groupe <span class="math inline">\(j\)</span> et de l’observation <span class="math inline">\(k\)</span>:</p>
<p><span class="math display">\[ \nu_j \sim N(0, \sigma_\alpha) \]</span> <span class="math display">\[ \epsilon_k \sim N(0, \sigma_y) \]</span></p>
<p>On peut considérer <span class="math inline">\(\nu_j\)</span> comme la portion du résidu qui est partagée par toutes les observations du groupe <span class="math inline">\(j\)</span>, tandis que <span class="math inline">\(\epsilon\)</span> est un résidu indépendant d’une observation à l’autre. Pour estimer ce modèle dans R, nous ajoutons simplement le prédicteur <code>Exposure</code> à la formule dans <code>lmer</code>. L’estimation fonctionne sans avoir besoin de dire explicitement à R que la valeur de cette variable est la même pour toutes les observations d’un groupe.</p>
<pre class="r"><code>mmod_exp &lt;- lmer(srich ~ NAP + Exposure + (1 | Beach), rikz)
summary(mmod_exp)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: srich ~ NAP + Exposure + (1 | Beach)
##    Data: rikz
## 
## REML criterion at convergence: 86
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.38707 -0.48281 -0.07465  0.47962  3.03495 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Beach    (Intercept) 0.02315  0.1521  
##  Residual             0.34658  0.5887  
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  3.62081    0.30510  11.867
## NAP         -0.70349    0.09107  -7.724
## Exposure10  -1.11766    0.33998  -3.287
## Exposure11  -1.66923    0.34021  -4.907
## 
## Correlation of Fixed Effects:
##            (Intr) NAP    Exps10
## NAP        -0.082              
## Exposure10 -0.891 -0.007       
## Exposure11 -0.888 -0.037  0.800</code></pre>
<p>Quelques notes sur ce résultat:</p>
<ul>
<li><p>L’estimé de <span class="math inline">\(\sigma_\alpha\)</span> (0.15) a beaucoup diminué par rapport à sa valeur dans le modèle précédent (0.54), montrant que le prédicteur explique une bonne partie des différences observées entre les groupes. L’écart-type des observations individuelles (0.59) n’a pas changé, ce qui est attendu car un prédicteur lié au groupe ne peut expliquer les différences entre observations d’un même groupe.</p></li>
<li><p>Il est normal d’observer des corrélations entre les effets fixes <code>(Intercept)</code>, <code>Exposure10</code> et <code>Exposure11</code>. Avec les constrastes par défaut dans R, <code>(Intercept)</code> est l’ordonnée à l’origine pour la valeur de référence de la variable (Exposure = 8), le coefficient <code>Exposure10</code> est la différence entre les niveaux 10 et 8, et le coefficient <code>Exposure11</code> est la différence entre les niveaux 11 et 8. Donc, si l’estimé de la moyenne du niveau 8 augmente, les deux différences (10 - 8 et 11 - 8) diminuent.</p></li>
</ul>
<p>Notons qu’après avoir tenu compte de l’effet de l’indice d’exposition, les effets aléatoires de groupe s’approchent davantage d’une distribution normale.</p>
<pre class="r"><code>beach_coef &lt;- ranef(mmod_exp)$`Beach`
qqnorm(beach_coef$`(Intercept)`)
qqline(beach_coef$`(Intercept)`)</code></pre>
<p><img src="11-Modeles_mixtes_Partie1_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="correlation-intra-classe" class="section level1">
<h1>Corrélation intra-classe</h1>
<p>Dans les modèles mixtes présentés ci-dessus, <span class="math inline">\(\sigma_\alpha\)</span> représente l’écart-type de la réponse moyenne entre les groupes tandis que <span class="math inline">\(\sigma_y\)</span> représente l’écart-type de la réponse entre observations d’un même groupe.</p>
<p>La <em>corrélation intra-classe</em> est définie comme le rapport:</p>
<p><span class="math display">\[ \frac{\sigma_\alpha^2}{\sigma_\alpha^2 + \sigma_y^2} \]</span></p>
<p>Ce rapport tend vers 0 si <span class="math inline">\(\sigma_y \gg \sigma_\alpha\)</span> (la variation entre groupes est négligeable par rapport à la variation entre individus d’un même groupe) et tend vers 1 si <span class="math inline">\(\sigma_\alpha \gg \sigma_y\)</span> (presque toute la variation est due aux différences entre groupes).</p>
<p>La corrélation intra-classe est d’environ 0.45 pour le premier modèle (<code>mmod</code>) et diminue à 0.06 en tenant compte de l’indice d’exposition (modèle <code>mmod_exp</code>).</p>
<p>D’un point de vue pratique, la corrélation intra-classe indique quelle échelle contribue davantage à la variation de la réponse, donc à quelle échelle nous pourrions échantillonner davantage pour réduire l’incertitude du modèle. Dans notre exemple, si cette corrélation approchait 1, il serait préférable d’échantillonner plusieurs plages avec peu d’échantillons par plage; dans le cas contraire, nous pourrions obtenir un plus grand échantillon sur un nombre limité de plages. Bien sûr, cela suppose que les plages observées jusqu’à maintenant sont représentatives de la “population” des plages qui nous intéressent.</p>
</div>
<div id="resume" class="section level1">
<h1>Résumé</h1>
<ul>
<li><p>Un modèle linéaire mixte (aussi appelé modèle multi-niveaux) est une extension de la régression linéaire pour des données groupées, où certains des coefficients varient de façon aléatoire d’un groupe à l’autre.</p></li>
<li><p>Dans ce cours, nous avons vu des exemples où l’ordonnée à l’origine inclut un effet aléatoire. Dans le prochain cours, nous verrons comment ajouter des effets aléatoires à d’autres coefficients.</p></li>
<li><p>Un modèle mixte constitue un compromis entre une régression linéaire qui ignore la structure groupée et une régression qui estime un effet fixe séparé pour chaque groupe.</p></li>
<li><p>Pour ce faire, le modèle mixte corrige l’estimation des effets de chaque groupe pour les rapprocher de la tendance générale (contraction). Plus l’échantillon d’un groupe est faible, plus cette correction est importante. Pour cette raison, les modèles mixtes sont particulièrement utiles lorsqu’on a un grand nombre de groupes et peu d’observations dans certains groupes.</p></li>
<li><p>Dans une régression linéaire classique, on ne peut inclure à la fois un effet fixe par groupe et un prédicteur défini à l’échelle du groupe. Un modèle mixte peut inclure à la fois l’effet aléatoire des groupes et une variable explicative définie à l’échelle du groupe.</p></li>
</ul>
</div>
<div id="references" class="section level1">
<h1>Références</h1>
<p>Voici deux excellents manuels à consulter pour plus de détails sur les modèles mixtes ou multi-niveaux.</p>
<ul>
<li><p>Gelman, A. and Hill, J. (2006) <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Cambridge, Cambridge University Press.</p></li>
<li><p>Zuur, A.F., Ieno, E.N., Walker, N.J., Saveliev, A.A., Smith, G.M. (2009) <em>Mixed Effects Models and Extensions in Ecology with R</em>. New York, Springer-Verlag.</p></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
